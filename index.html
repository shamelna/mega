<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEGA LEAN Assessment Tool</title>
    <link rel="icon" type="image/x-icon" href="https://practitioner.kaizenacademy.education/Tcia.ico">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #2d2d2d;
            background-color: #033d5c;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: #ffffff;
            border-radius: 0 0 15px 15px;
            padding: 20px 40px;
            margin: 0 -20px 30px -20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-container {
            flex: 0 0 auto;
        }

        .logo {
            height: 60px;
            width: auto;
        }

        .header-text {
            flex: 1;
            text-align: center;
            padding: 0 20px;
        }

        .header-text h1 {
            color: #821874;
            font-size: 2em;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .header-text p {
            color: #2d2d2d;
            font-size: 1em;
        }

        .data-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #856404;
        }

        .data-warning h4 {
            margin-bottom: 10px;
            color: #821874;
        }

        .navigation {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #821874;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.95);
            border-color: #821874;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .nav-btn.active {
            background: #821874;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(130, 24, 116, 0.4);
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .panel.active {
            display: block;
        }

        .form-section {
            margin-bottom: 35px;
            border: 1px solid #ebebeb;
            border-radius: 12px;
            padding: 25px;
            background: #f4f4f4;
        }

        .form-section h3 {
            color: #821874;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 2px solid #821874;
            padding-bottom: 10px;
        }

        .question-group {
            margin-bottom: 20px;
        }

        .question-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d2d2d;
        }

        .radio-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px 12px;
            background: white;
            border-radius: 6px;
            border: 2px solid #ebebeb;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .radio-option:hover {
            border-color: #821874;
            background: #fef5fe;
        }

        .radio-option input[type="radio"] {
            margin: 0;
            accent-color: #821874;
        }

        .form-actions {
            text-align: center;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #ebebeb;
        }

        .btn {
            padding: 12px 30px;
            border: 2px solid transparent;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 10px;
        }

        .btn-primary {
            background: #821874;
            color: #ffffff;
            border-color: #821874;
        }

        .btn-primary:hover {
            background: rgba(130, 24, 116, 0.9);
            border-color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(130, 24, 116, 0.3);
        }

        .btn-secondary {
            background: #159eda;
            color: white;
            border-color: #159eda;
        }

        .btn-secondary:hover {
            background: rgba(21, 158, 218, 0.9);
            border-color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(21, 158, 218, 0.3);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .btn-danger:hover {
            background: rgba(220, 53, 69, 0.9);
            border-color: #ffffff;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 14px;
        }

        .status-overview {
            background: linear-gradient(135deg, #821874 0%, #159eda 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .status-large {
            font-size: 3em;
            font-weight: 700;
            margin: 20px 0;
        }

        .progress-ring {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            position: relative;
        }

        .progress-ring svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 15;
        }

        .progress-ring .background {
            stroke: rgba(255, 255, 255, 0.3);
        }

        .progress-ring .progress {
            stroke: #7EBEC5;
            stroke-linecap: round;
            transition: stroke-dasharray 1s ease-in-out;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2em;
            font-weight: 700;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #ebebeb;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 600;
            color: #2d2d2d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab:hover {
            color: #821874;
        }

        .tab.active {
            color: #821874;
            border-bottom-color: #821874;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dimension-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #ebebeb;
        }

        .dimension-card h4 {
            color: #821874;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .progress-container {
            position: relative;
            background: #f4f4f4;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-bar {
            height: 100%;
            border-radius: 15px;
            transition: width 0.8s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .status-novice { background: linear-gradient(45deg, #dc3545, #c82333); }
        .status-emerging { background: linear-gradient(45deg, #fd7e14, #e55a00); }
        .status-developing { background: linear-gradient(45deg, #ffc107, #e0a800); }
        .status-advanced { background: linear-gradient(45deg, #7EBEC5, #159eda); }

        .status-label {
            font-size: 14px;
            font-weight: 600;
            text-align: center;
        }

        .saved-assessments {
            margin-bottom: 20px;
        }

        .assessment-item {
            background: white;
            border: 1px solid #ebebeb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .assessment-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .manual-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .manual-content h2 {
            color: #821874;
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #821874;
        }

        .manual-content h3 {
            color: #159eda;
            margin: 25px 0 10px 0;
        }

        .manual-content a {
            color: #159eda;
            text-decoration: none;
        }

        .manual-content a:hover {
            text-decoration: underline;
        }

        .manual-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .manual-content table th,
        .manual-content table td {
            border: 1px solid #ebebeb;
            padding: 12px;
            text-align: left;
        }

        .manual-content table th {
            background: #f4f4f4;
            font-weight: 600;
            color: #821874;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="date"],
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ebebeb;
            border-radius: 8px;
            margin-bottom: 15px;
            font-family: inherit;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus,
        input[type="date"]:focus,
        select:focus {
            outline: none;
            border-color: #821874;
            box-shadow: 0 0 0 3px rgba(130, 24, 116, 0.1);
        }

        .footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
        }

        .footer a {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
            }

            .logo {
                height: 50px;
                margin-bottom: 15px;
            }

            .header-text {
                padding: 0;
            }

            .header-text h1 {
                font-size: 1.5em;
            }

            .navigation {
                flex-direction: column;
                align-items: center;
            }
            
            .radio-group {
                flex-direction: column;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }

            .assessment-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .assessment-actions {
                width: 100%;
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <img src="https://mega.kaizenacademy.education/images/mega_logo.png" alt="MEGA Logo" class="logo">
            </div>
            <div class="header-text">
                <h1>LEAN Assessment Tool</h1>
                <p>Comprehensive evaluation of your organization's LEAN maturity</p>
            </div>
        </div>

        <!-- Login Section -->
        <div id="loginSection" class="panel active" style="display: block;">
            <div style="max-width: 400px; margin: 0 auto; text-align: center;">
                <h2 style="color: #821874;">User Access</h2>
                <p>Please identify yourself to access your assessments</p>
                
                <div class="data-warning">
                    <h4>☁️ Cloud Storage - Powered by Supabase</h4>
                    <p><strong>Your assessments are stored in the cloud!</strong> Access them from any device by logging in with the same email.</p>
                </div>
                
                <div style="margin: 30px 0;">
                    <label for="userEmail" style="display: block; margin-bottom: 10px; font-weight: 600; text-align: left;">Email Address:</label>
                    <input type="email" id="userEmail" placeholder="Enter your email">
                    
                    <label for="userRole" style="display: block; margin-bottom: 10px; font-weight: 600; text-align: left;">Access Level:</label>
                    <select id="userRole">
                        <option value="user">Regular User</option>
                        <option value="admin">Administrator</option>
                    </select>
                    
                    <div id="adminPassword" style="display: none;">
                        <label for="adminPass" style="display: block; margin-bottom: 10px; font-weight: 600; text-align: left;">Admin Password:</label>
                        <input type="password" id="adminPass" placeholder="Enter admin password">
                    </div>
                    
                    <button class="btn btn-primary" onclick="userLogin()" style="width: 100%; margin-top: 10px;">Access Assessments</button>
                </div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ebebeb; font-size: 14px; color: #2d2d2d;">
                    <p><strong>Regular Users:</strong> Create and manage your own assessments</p>
                    <p><strong>Administrators:</strong> View all assessments and organization analytics</p>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation" id="mainNavigation" style="display: none;">
            <button class="nav-btn active" onclick="showPanel('assessment')">New Assessment</button>
            <button class="nav-btn" onclick="showPanel('dashboard')">My Dashboard</button>
            <button class="nav-btn" onclick="showPanel('saved')">My Assessments</button>
            <button class="nav-btn" onclick="showPanel('manual')">Help & Manual</button>
            <button class="nav-btn" id="adminNav" onclick="showPanel('admin')" style="display: none;">Admin Panel</button>
            <button class="nav-btn btn-danger" onclick="userLogout()">Logout</button>
        </div>

        <!-- Assessment Panel -->
        <div id="assessmentPanel" class="panel">
            <div class="data-warning">
                <h4>Assessment Guidelines</h4>
                <p><strong>Please allow 30-45 minutes</strong> to complete this assessment. Answer honestly based on your organization's current state. You can save your progress as a draft at any time.</p>
            </div>

            <form id="assessmentForm">
                <div class="form-section">
                    <h3>Company Information</h3>
                    <div class="question-group">
                        <label for="companyName">Company Name:</label>
                        <input type="text" id="companyName" name="companyName" required>
                    </div>
                    <div class="question-group">
                        <label for="assessorName">Assessor Name:</label>
                        <input type="text" id="assessorName" name="assessorName" required>
                    </div>
                    <div class="question-group">
                        <label for="assessmentDate">Assessment Date:</label>
                        <input type="date" id="assessmentDate" name="assessmentDate" required>
                    </div>
                </div>

                <!-- Section 1: Leadership & Culture -->
                <div class="form-section">
                    <h3>1. Leadership & Culture (Questions 1-5)</h3>
                    <p style="color: #2d2d2d; margin-bottom: 20px;">Evaluates how well leadership promotes LEAN principles and creates a culture of continuous improvement.</p>
                    <div class="question-group">
                        <label>Q1: Leaders actively promote LEAN principles across all levels.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q1" value="1"> <span>1 - Strongly Disagree</span></div>
                            <div class="radio-option"><input type="radio" name="q1" value="2"> <span>2 - Disagree</span></div>
                            <div class="radio-option"><input type="radio" name="q1" value="3"> <span>3 - Neutral</span></div>
                            <div class="radio-option"><input type="radio" name="q1" value="4"> <span>4 - Agree</span></div>
                            <div class="radio-option"><input type="radio" name="q1" value="5"> <span>5 - Strongly Agree</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q2: Continuous improvement is embedded in our organizational culture.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q2" value="1"> <span>1 - Strongly Disagree</span></div>
                            <div class="radio-option"><input type="radio" name="q2" value="2"> <span>2 - Disagree</span></div>
                            <div class="radio-option"><input type="radio" name="q2" value="3"> <span>3 - Neutral</span></div>
                            <div class="radio-option"><input type="radio" name="q2" value="4"> <span>4 - Agree</span></div>
                            <div class="radio-option"><input type="radio" name="q2" value="5"> <span>5 - Strongly Agree</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q3: Employees are empowered to identify and solve problems.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q3" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q3" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q3" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q3" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q3" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q4: LEAN thinking is part of strategic decision-making.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q4" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q4" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q4" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q4" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q4" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q5: Failures are treated as learning opportunities.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q5" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q5" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q5" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q5" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q5" value="5"> <span>5</span></div>
                        </div>
                    </div>
                </div>

                <!-- Section 2-7: Remaining sections with all 35 questions -->
                <!-- For brevity, showing abbreviated sections. In production, all questions Q6-Q35 would be included with same structure -->
                
                <!-- Customer Value Focus (Q6-Q10) -->
                <div class="form-section">
                    <h3>2. Customer Value Focus (Questions 6-10)</h3>
                    <p style="color: #2d2d2d; margin-bottom: 20px;">Measures how well your organization understands and delivers customer value.</p>
                    <div class="question-group">
                        <label>Q6: We clearly understand what our customers value most.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q6" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q6" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q6" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q6" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q6" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q7: Processes are designed to maximize customer value.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q7" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q7" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q7" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q7" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q7" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q8: Feedback loops from customers are frequent and actionable.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q8" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q8" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q8" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q8" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q8" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q9: Waste that does not add customer value is systematically eliminated.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q9" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q9" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q9" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q9" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q9" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q10: We regularly review our offerings to align with evolving customer needs.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q10" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q10" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q10" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q10" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q10" value="5"> <span>5</span></div>
                        </div>
                    </div>
                </div>

                <!-- Process Efficiency (Q11-Q15) -->
                <div class="form-section">
                    <h3>3. Process Efficiency (Questions 11-15)</h3>
                    <p style="color: #2d2d2d; margin-bottom: 20px;">Assesses standardization, bottleneck management, and process optimization.</p>
                    <div class="question-group">
                        <label>Q11: Standardized work is documented and followed consistently.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q11" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q11" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q11" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q11" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q11" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q12: Bottlenecks and inefficiencies are quickly identified and addressed.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q12" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q12" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q12" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q12" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q12" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q13: Visual management tools are used effectively.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q13" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q13" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q13" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q13" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q13" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q14: Value stream mapping is used to optimize workflows.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q14" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q14" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q14" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q14" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q14" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q15: We use metrics to monitor and improve process performance.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q15" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q15" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q15" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q15" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q15" value="5"> <span>5</span></div>
                        </div>
                    </div>
                </div>

                <!-- Waste Elimination (Q16-Q20) -->
                <div class="form-section">
                    <h3>4. Waste Elimination - Muda (Questions 16-20)</h3>
                    <p style="color: #2d2d2d; margin-bottom: 20px;">Reviews your ability to identify and eliminate the 8 types of waste.</p>
                    <div class="question-group">
                        <label>Q16: We actively identify and eliminate the 8 types of waste.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q16" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q16" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q16" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q16" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q16" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q17: Employees are trained to recognize waste in their daily work.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q17" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q17" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q17" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q17" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q17" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q18: Waste reduction initiatives are tracked and reviewed.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q18" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q18" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q18" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q18" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q18" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q19: Inventory levels are optimized to reduce excess.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q19" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q19" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q19" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q19" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q19" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q20: We use 5S to maintain organized and efficient workspaces.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q20" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q20" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q20" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q20" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q20" value="5"> <span>5</span></div>
                        </div>
                    </div>
                </div>

                <!-- Continuous Improvement (Q21-Q25) -->
                <div class="form-section">
                    <h3>5. Continuous Improvement - Kaizen (Questions 21-25)</h3>
                    <p style="color: #2d2d2d; margin-bottom: 20px;">Evaluates your Kaizen culture and improvement practices.</p>
                    <div class="question-group">
                        <label>Q21: Improvement ideas are regularly submitted by frontline staff.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q21" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q21" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q21" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q21" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q21" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q22: Cross-functional teams work on improvement projects.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q22" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q22" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q22" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q22" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q22" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q23: PDCA (Plan-Do-Check-Act) cycles are used consistently.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q23" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q23" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q23" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q23" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q23" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q24: Improvements are documented and shared across teams.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q24" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q24" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q24" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q24" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q24" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q25: We celebrate and recognize successful improvement efforts.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q25" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q25" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q25" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q25" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q25" value="5"> <span>5</span></div>
                        </div>
                    </div>
                </div>

                <!-- Flow and Pull Systems (Q26-Q30) -->
                <div class="form-section">
                    <h3>6. Flow and Pull Systems (Questions 26-30)</h3>
                    <p style="color: #2d2d2d; margin-bottom: 20px;">Assesses workflow optimization and pull system implementation.</p>
                    <div class="question-group">
                        <label>Q26: Work flows smoothly with minimal interruptions.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q26" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q26" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q26" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q26" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q26" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q27: We use pull systems (e.g., Kanban) to manage work-in-progress.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q27" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q27" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q27" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q27" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q27" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q28: Production is based on actual demand, not forecasts.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q28" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q28" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q28" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q28" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q28" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q29: Setup times are minimized to support flow.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q29" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q29" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q29" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q29" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q29" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q30: We balance workloads to avoid overburdening teams.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q30" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q30" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q30" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q30" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q30" value="5"> <span>5</span></div>
                        </div>
                    </div>
                </div>

                <!-- Problem Solving (Q31-Q35) -->
                <div class="form-section">
                    <h3>7. Problem Solving & Root Cause Analysis (Questions 31-35)</h3>
                    <p style="color: #2d2d2d; margin-bottom: 20px;">Reviews structured problem-solving capabilities.</p>
                    <div class="question-group">
                        <label>Q31: Structured problem-solving methods (e.g., A3, 5 Whys) are used.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q31" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q31" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q31" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q31" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q31" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q32: Problems are addressed at the source, not just symptoms.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q32" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q32" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q32" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q32" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q32" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q33: Data is used to support root cause analysis.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q33" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q33" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q33" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q33" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q33" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q34: Corrective actions are tracked for effectiveness.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q34" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q34" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q34" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q34" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q34" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q35: Teams are trained in problem-solving techniques.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q35" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q35" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q35" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q35" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q35" value="5"> <span>5</span></div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-primary" onclick="submitAssessment()">Submit Assessment</button>
                    <button type="button" class="btn btn-secondary" onclick="saveAssessment()">Save Draft</button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">Reset Form</button>
                </div>
            </form>
        </div>

        <!-- Dashboard Panel -->
        <div id="dashboardPanel" class="panel">
            <div class="status-overview">
                <h2>LEAN Maturity Assessment Results</h2>
                <div class="progress-ring">
                    <svg>
                        <circle class="background" cx="100" cy="100" r="85"></circle>
                        <circle class="progress" cx="100" cy="100" r="85" id="progressCircle"></circle>
                    </svg>
                    <div class="progress-text" id="progressText">0%</div>
                </div>
                <div class="status-large" id="statusLarge">Not Assessed</div>
                <div id="statusDescription">Complete an assessment to see your organization's LEAN maturity level</div>
            </div>

            <div id="overviewTab" class="tab-content active">
                <div class="results-grid" id="enhancedResultsGrid"></div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="showPanel('assessment')">New Assessment</button>
            </div>
        </div>

        <!-- Saved Assessments Panel -->
        <div id="savedPanel" class="panel">
            <h2 style="color: #821874;">My Assessments</h2>
            <div class="data-warning">
                <h4>Cloud Storage Information</h4>
                <p>Your assessments are stored securely in the cloud and accessible from any device.</p>
            </div>
            <div class="saved-assessments" id="savedAssessments"></div>
        </div>

        <!-- Help & Manual Panel -->
        <div id="manualPanel" class="panel">
            <div class="manual-content">
                <h1 style="color: #821874;">MEGA LEAN Assessment Tool - User Manual</h1>
                
                <h2>Getting Started</h2>
                <p>The MEGA LEAN Assessment Tool evaluates your organization's LEAN maturity across 7 key dimensions.</p>

                <h2>Understanding Your Results</h2>
                <h3>LEAN Maturity Levels</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Score Range</th>
                            <th>Status</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>0-31%</td>
                            <td><span style="background: #dc3545; color: white; padding: 4px 8px; border-radius: 4px;">Novice</span></td>
                            <td>LEAN awareness exists, but implementation is limited</td>
                        </tr>
                        <tr>
                            <td>32-48%</td>
                            <td><span style="background: #fd7e14; color: white; padding: 4px 8px; border-radius: 4px;">Emerging</span></td>
                            <td>LEAN practices are emerging but not yet consistent</td>
                        </tr>
                        <tr>
                            <td>49-66%</td>
                            <td><span style="background: #ffc107; color: white; padding: 4px 8px; border-radius: 4px;">Developing</span></td>
                            <td>Strong LEAN foundation with room for refinement</td>
                        </tr>
                        <tr>
                            <td>67%+</td>
                            <td><span style="background: #159eda; color: white; padding: 4px 8px; border-radius: 4px;">Advanced</span></td>
                            <td>LEAN is deeply embedded and continuously evolving</td>
                        </tr>
                    </tbody>
                </table>

                <h2>Rating Scale</h2>
                <ul>
                    <li><strong>1 - Strongly Disagree:</strong> This practice doesn't exist</li>
                    <li><strong>2 - Disagree:</strong> This practice exists but is inconsistent/poor</li>
                    <li><strong>3 - Neutral:</strong> This practice exists but has room for improvement</li>
                    <li><strong>4 - Agree:</strong> This practice is well-established and effective</li>
                    <li><strong>5 - Strongly Agree:</strong> This practice is excellent and consistently applied</li>
                </ul>

                <h2>Tips for Best Results</h2>
                <ul>
                    <li><strong>Be honest</strong> - Answer based on current reality</li>
                    <li><strong>Allow adequate time</strong> - Plan 30-45 minutes</li>
                    <li><strong>Involve others</strong> - Consider multiple perspectives</li>
                    <li><strong>Stay consistent</strong> - Apply same perspective throughout</li>
                </ul>

                <h2>For More Information</h2>
                <p>Visit <a href="https://mega.kaizenacademy.education" target="_blank">MEGA Kaizen Academy</a> for training programs and coaching services.</p>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="panel">
            <h2 style="color: #821874;">Administrator Dashboard</h2>
            <div class="data-warning">
                <h4>Admin Features</h4>
                <p>View all assessments created in the system. All data is securely stored in the cloud.</p>
            </div>
            <div class="saved-assessments" id="adminAssessments"></div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>© 2024 MEGA LEAN Assessment Tool</p>
            <p>Designed by <strong>Kaizen Academy™</strong></p>
            <p><a href="https://kaizenacademy.education" target="_blank">Learn More</a> | <a href="mailto:info@continuousimprovement.education">Contact Us</a></p>
        </div>
    </div>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // ============================================
        // SUPABASE CONFIGURATION
        // ============================================
        const SUPABASE_URL = 'https://hammdlesdcmenhronfml.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhhbW1kbGVzZGNtZW5ocm9uZm1sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIwMzUwMTYsImV4cCI6MjA3NzYxMTAxNn0.pFmZoSrCLCSMLrbBmTh3L-MMdJ6GL-5G-NKDr4YIV6g';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        console.log("✓ Supabase initialized successfully!");
        
        let supabaseUser = null;
        
        async function setSupabaseUser(email) {
            supabaseUser = { email: email };
            console.log("✓ User context set for:", email);
        }

        // ============================================
        // USER MANAGEMENT
        // ============================================
        const ADMIN_PASSWORD = "mega2025";
        let currentUser = null;
        let currentAssessmentId = null;

        const DIMENSIONS = [
            { name: 'Leadership & Culture', questions: 5 },
            { name: 'Customer Value Focus', questions: 5 },
            { name: 'Process Efficiency', questions: 5 },
            { name: 'Waste Elimination - Muda', questions: 5 },
            { name: 'Continuous Improvement - Kaizen', questions: 5 },
            { name: 'Flow and Pull Systems', questions: 5 },
            { name: 'Problem Solving & Root Cause Analysis', questions: 5 }
        ];

        function checkUserSession() {
            const user = sessionStorage.getItem('currentUser');
            if (user) {
                currentUser = JSON.parse(user);
                return true;
            }
            return false;
        }

        async function userLogin() {
            const email = document.getElementById('userEmail').value.trim();
            const role = document.getElementById('userRole').value;
            const adminPass = document.getElementById('adminPass').value;

            if (!email) {
                alert('Please enter your email address.');
                return;
            }

            if (role === 'admin' && adminPass !== ADMIN_PASSWORD) {
                alert('Incorrect admin password.');
                return;
            }

            currentUser = {
                email: email,
                role: role,
                loginTime: new Date().toISOString()
            };

            sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
            await setSupabaseUser(email);

            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('mainNavigation').style.display = 'flex';
            
            if (role === 'admin') {
                document.getElementById('adminNav').style.display = 'block';
                await loadAdminDashboard();
            }

            showPanel('assessment');
            await loadUserAssessments();
            document.getElementById('assessmentDate').value = new Date().toISOString().split('T')[0];
        }

        function userLogout() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                supabaseUser = null;
                sessionStorage.removeItem('currentUser');
                
                document.getElementById('loginSection').style.display = 'block';
                document.getElementById('mainNavigation').style.display = 'none';
                document.getElementById('userEmail').value = '';
                document.getElementById('adminPass').value = '';
                
                showPanel('assessment');
            }
        }

        // ============================================
        // ASSESSMENT FUNCTIONS
        // ============================================

        function validateAssessment() {
            for (let i = 1; i <= 35; i++) {
                const checked = document.querySelector(`input[name="q${i}"]:checked`);
                if (!checked) {
                    alert(`Please answer question ${i}.`);
                    return false;
                }
            }
            return true;
        }

        function getFormResponses() {
            const responses = {
                companyName: document.getElementById('companyName').value,
                assessorName: document.getElementById('assessorName').value,
                assessmentDate: document.getElementById('assessmentDate').value
            };

            for (let i = 1; i <= 35; i++) {
                const checked = document.querySelector(`input[name="q${i}"]:checked`);
                if (checked) {
                    responses[`q${i}`] = parseInt(checked.value);
                }
            }

            return responses;
        }

        function calculateResults() {
            const results = [];
            let totalScore = 0;
            let questionIndex = 1;

            for (let d = 0; d < DIMENSIONS.length; d++) {
                let dimensionTotal = 0;
                for (let q = 0; q < DIMENSIONS[d].questions; q++) {
                    const value = parseInt(document.querySelector(`input[name="q${questionIndex}"]:checked`).value);
                    dimensionTotal += value;
                    questionIndex++;
                }
                const maxScore = DIMENSIONS[d].questions * 5;
                const percentage = (dimensionTotal / maxScore) * 100;
                results.push({
                    dimension: DIMENSIONS[d].name,
                    score: dimensionTotal,
                    maxScore: maxScore,
                    percentage: Math.round(percentage)
                });
                totalScore += dimensionTotal;
            }

            const overallMaxScore = 35 * 5;
            const overallPercentage = (totalScore / overallMaxScore) * 100;

            return {
                dimensions: results,
                totalScore: totalScore,
                overallMaxScore: overallMaxScore,
                overallPercentage: Math.round(overallPercentage),
                status: getStatusLabel(overallPercentage)
            };
        }

        function getStatusLabel(percentage) {
            if (percentage <= 31) return 'Novice';
            if (percentage <= 48) return 'Emerging';
            if (percentage <= 66) return 'Developing';
            return 'Advanced';
        }

        function getStatusClass(percentage) {
            if (percentage <= 31) return 'status-novice';
            if (percentage <= 48) return 'status-emerging';
            if (percentage <= 66) return 'status-developing';
            return 'status-advanced';
        }

        async function saveAssessmentToStorage(assessment) {
            if (!currentUser) {
                alert('Please login first.');
                return;
            }

            assessment.user_email = currentUser.email;
            assessment.user_name = currentUser.email.split('@')[0];
            
            try {
                if (assessment.id && assessment.id !== Date.now()) {
                    // Update existing
                    const { data: existing, error: fetchError } = await supabase
                        .from('assessments')
                        .select('*')
                        .eq('id', assessment.id)
                        .single();
                    
                    if (fetchError) {
                        alert('Error loading assessment: ' + fetchError.message);
                        return;
                    }
                    
                    if (currentUser.role !== 'admin' && existing.user_email !== currentUser.email) {
                        alert('You can only edit your own assessments.');
                        return;
                    }
                    
                    const { error } = await supabase
                        .from('assessments')
                        .update({
                            company_name: assessment.companyName,
                            assessor_name: assessment.assessorName,
                            assessment_date: assessment.assessmentDate,
                            responses: assessment.responses,
                            results: assessment.results,
                            is_draft: assessment.isDraft || false
                        })
                        .eq('id', assessment.id);
                    
                    if (error) {
                        alert('Error updating: ' + error.message);
                        return;
                    }
                    
                    alert('Assessment updated successfully!');
                } else {
                    // Create new
                    const newAssessment = {
                        user_email: currentUser.email,
                        user_name: currentUser.email.split('@')[0],
                        company_name: assessment.companyName,
                        assessor_name: assessment.assessorName,
                        assessment_date: assessment.assessmentDate,
                        responses: assessment.responses,
                        results: assessment.results,
                        is_draft: assessment.isDraft || false
                    };
                    
                    const { data, error } = await supabase
                        .from('assessments')
                        .insert([newAssessment])
                        .select();
                    
                    if (error) {
                        alert('Error saving: ' + error.message);
                        return;
                    }
                    
                    if (data && data[0]) {
                        currentAssessmentId = data[0].id;
                    }
                    
                    alert('Assessment saved successfully!');
                }
            } catch (error) {
                alert('Unexpected error: ' + error.message);
            }
        }

        async function submitAssessment() {
            if (!validateAssessment()) {
                return;
            }

            const results = calculateResults();
            const assessment = {
                id: currentAssessmentId || null,
                companyName: document.getElementById('companyName').value,
                assessorName: document.getElementById('assessorName').value,
                assessmentDate: document.getElementById('assessmentDate').value,
                results: results,
                responses: getFormResponses(),
                isDraft: false
            };

            await saveAssessmentToStorage(assessment);
            
            currentAssessmentId = null;
            document.getElementById('assessmentForm').reset();
            document.getElementById('assessmentDate').value = new Date().toISOString().split('T')[0];
            
            showPanel('dashboard');
        }

        async function saveAssessment() {
            if (document.getElementById('companyName').value === '') {
                alert('Please enter company name.');
                return;
            }

            const assessment = {
                id: currentAssessmentId || null,
                companyName: document.getElementById('companyName').value,
                assessorName: document.getElementById('assessorName').value,
                assessmentDate: document.getElementById('assessmentDate').value,
                results: null,
                responses: getFormResponses(),
                isDraft: true
            };

            await saveAssessmentToStorage(assessment);
        }

        function resetForm() {
            if (confirm('Are you sure you want to reset the form?')) {
                document.getElementById('assessmentForm').reset();
                document.getElementById('assessmentDate').value = new Date().toISOString().split('T')[0];
                currentAssessmentId = null;
            }
        }

        // ============================================
        // PANEL MANAGEMENT
        // ============================================

        function showPanel(panelName) {
            document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));
            
            switch(panelName) {
                case 'assessment':
                    document.getElementById('assessmentPanel').classList.add('active');
                    break;
                case 'dashboard':
                    document.getElementById('dashboardPanel').classList.add('active');
                    loadDashboard();
                    break;
                case 'saved':
                    document.getElementById('savedPanel').classList.add('active');
                    loadSavedAssessments();
                    break;
                case 'manual':
                    document.getElementById('manualPanel').classList.add('active');
                    break;
                case 'admin':
                    document.getElementById('adminPanel').classList.add('active');
                    break;
            }
        }

        // ============================================
        // DASHBOARD & DATA LOADING
        // ============================================

        async function loadUserAssessments() {
            if (!currentUser) return [];
            
            try {
                let query = supabase
                    .from('assessments')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (currentUser.role !== 'admin') {
                    query = query.eq('user_email', currentUser.email);
                }
                
                const { data, error } = await query;
                
                if (error) {
                    console.error('Error loading assessments:', error);
                    return [];
                }
                
                return data || [];
            } catch (error) {
                console.error('Error:', error);
                return [];
            }
        }

        async function loadDashboard() {
            const assessments = await loadUserAssessments();
            
            if (assessments.length === 0) {
                document.getElementById('statusLarge').textContent = 'Not Assessed';
                document.getElementById('statusDescription').textContent = 'Complete an assessment to see your organization\'s LEAN maturity level';
                document.getElementById('progressText').textContent = '0%';
                document.getElementById('enhancedResultsGrid').innerHTML = '';
                return;
            }

            const latestAssessment = assessments[0];
            const results = latestAssessment.results;

            if (!results) return;

            document.getElementById('statusLarge').textContent = results.status;
            document.getElementById('statusDescription').textContent = `Overall Score: ${results.overallPercentage}%`;
            document.getElementById('progressText').textContent = results.overallPercentage + '%';

            const circumference = 2 * Math.PI * 85;
            const offset = circumference - (results.overallPercentage / 100) * circumference;
            document.getElementById('progressCircle').style.strokeDasharray = circumference;
            document.getElementById('progressCircle').style.strokeDashoffset = offset;

            let html = '';
            for (const dim of results.dimensions) {
                const status = getStatusClass(dim.percentage);
                html += `
                    <div class="dimension-card">
                        <h4>${dim.dimension}</h4>
                        <div class="progress-container">
                            <div class="progress-bar ${status}" style="width: ${dim.percentage}%;">
                                ${dim.percentage}%
                            </div>
                        </div>
                        <div class="status-label">${dim.score} / ${dim.maxScore}</div>
                    </div>
                `;
            }
            document.getElementById('enhancedResultsGrid').innerHTML = html;
        }

        async function loadSavedAssessments() {
            const assessments = await loadUserAssessments();
            
            let html = '';
            if (assessments.length === 0) {
                html = '<p style="text-align: center; color: #999;">No assessments found. Create one to get started!</p>';
            } else {
                for (const assessment of assessments) {
                    const date = new Date(assessment.created_at).toLocaleDateString();
                    const status = assessment.is_draft ? 'Draft' : 'Completed';
                    const statusColor = assessment.is_draft ? '#ffc107' : '#28a745';
                    
                    html += `
                        <div class="assessment-item">
                            <div>
                                <strong>${assessment.company_name}</strong><br>
                                <small style="color: #999;">Assessed on ${date} by ${assessment.assessor_name}</small><br>
                                <span style="display: inline-block; background: ${statusColor}; color: white; padding: 3px 8px; border-radius: 4px; font-size: 12px; margin-top: 5px;">${status}</span>
                            </div>
                            <div class="assessment-actions">
                                <button class="btn btn-sm btn-secondary" onclick="loadAssessmentForEdit(${assessment.id})">Edit</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteAssessment(${assessment.id})">Delete</button>
                            </div>
                        </div>
                    `;
                }
            }
            document.getElementById('savedAssessments').innerHTML = html;
        }

        async function deleteAssessment(id) {
            try {
                const { data: assessment, error: fetchError } = await supabase
                    .from('assessments')
                    .select('*')
                    .eq('id', id)
                    .single();
                
                if (fetchError) {
                    alert('Assessment not found.');
                    return;
                }
                
                if (currentUser.role !== 'admin' && assessment.user_email !== currentUser.email) {
                    alert('You can only delete your own assessments.');
                    return;
                }
                
                if (confirm('Are you sure you want to delete this assessment?')) {
                    const { error } = await supabase
                        .from('assessments')
                        .delete()
                        .eq('id', id);
                    
                    if (error) {
                        alert('Error deleting: ' + error.message);
                        return;
                    }
                    
                    alert('Deleted successfully!');
                    await loadSavedAssessments();
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function loadAssessmentForEdit(id) {
            try {
                const { data: assessment, error } = await supabase
                    .from('assessments')
                    .select('*')
                    .eq('id', id)
                    .single();
                
                if (error) {
                    alert('Assessment not found.');
                    return;
                }
                
                if (currentUser.role !== 'admin' && assessment.user_email !== currentUser.email) {
                    alert('You can only edit your own assessments.');
                    return;
                }
                
                if (assessment && assessment.responses) {
                    currentAssessmentId = assessment.id;
                    
                    document.getElementById('companyName').value = assessment.responses.companyName || '';
                    document.getElementById('assessorName').value = assessment.responses.assessorName || '';
                    document.getElementById('assessmentDate').value = assessment.responses.assessmentDate || '';
                    
                    for (let i = 1; i <= 35; i++) {
                        if (assessment.responses[`q${i}`]) {
                            const radio = document.querySelector(`input[name="q${i}"][value="${assessment.responses[`q${i}`]}"]`);
                            if (radio) {
                                radio.checked = true;
                                radio.closest('.radio-option').style.background = '#fef5fe';
                                radio.closest('.radio-option').style.borderColor = '#821874';
                            }
                        }
                    }
                    
                    showPanel('assessment');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function loadAdminDashboard() {
            try {
                const { data: allAssessments, error } = await supabase
                    .from('assessments')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) {
                    console.error('Error:', error);
                    return;
                }

                let html = '';
                if (allAssessments && allAssessments.length > 0) {
                    for (const assessment of allAssessments) {
                        const date = new Date(assessment.created_at).toLocaleDateString();
                        const status = assessment.is_draft ? 'Draft' : 'Completed';
                        
                        html += `
                            <div class="assessment-item">
                                <div>
                                    <strong>${assessment.company_name}</strong> (${assessment.user_email})<br>
                                    <small style="color: #999;">Assessed on ${date} by ${assessment.assessor_name}</small><br>
                                    <span style="display: inline-block; background: #159eda; color: white; padding: 3px 8px; border-radius: 4px; font-size: 12px; margin-top: 5px;">${status}</span>
                                </div>
                            </div>
                        `;
                    }
                } else {
                    html = '<p style="text-align: center; color: #999;">No assessments found.</p>';
                }
                
                document.getElementById('adminAssessments').innerHTML = html;
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // ============================================
        // INITIALIZATION
        // ============================================

        document.addEventListener('DOMContentLoaded', function() {
            if (!checkUserSession()) {
                document.getElementById('loginSection').style.display = 'block';
                document.getElementById('mainNavigation').style.display = 'none';
            }
            
            document.getElementById('assessmentDate').value = new Date().toISOString().split('T')[0];
            
            document.getElementById('userRole').addEventListener('change', function() {
                const adminPasswordDiv = document.getElementById('adminPassword');
                if (this.value === 'admin') {
                    adminPasswordDiv.style.display = 'block';
                } else {
                    adminPasswordDiv.style.display = 'none';
                    document.getElementById('adminPass').value = '';
                }
            });
            
            document.querySelectorAll('.radio-option').forEach(option => {
                option.addEventListener('click', function() {
                    const radio = this.querySelector('input[type="radio"]');
                    radio.checked = true;
                    
                    const name = radio.name;
                    document.querySelectorAll(`input[name="${name}"]`).forEach(r => {
                        r.closest('.radio-option').style.background = 'white';
                        r.closest('.radio-option').style.borderColor = '#ebebeb';
                    });
                    
                    this.style.background = '#fef5fe';
                    this.style.borderColor = '#821874';
                });
            });
        });
    </script>
</body>
</html>