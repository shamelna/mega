<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEGA LEAN Assessment Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #2d2d2d;
            background: linear-gradient(135deg, #821874 0%, #159eda 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: #ffffff;
            border-radius: 0 0 15px 15px;
            padding: 20px 40px;
            margin: 0 -20px 30px -20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo-container {
            flex: 0 0 auto;
        }

        .logo {
            height: 60px;
            width: auto;
        }

        .header-text {
            flex: 1;
            text-align: center;
            padding: 0 20px;
        }

        .header-text h1 {
            color: #821874;
            font-size: 2em;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .header-text p {
            color: #2d2d2d;
            font-size: 1em;
        }

        .data-warning {
            background: #e8f5e9;
            border: 1px solid #81c784;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #2d2d2d;
        }

        .data-warning h4 {
            margin-bottom: 10px;
            color: #821874;
        }

        .navigation {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: #821874;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.95);
            border-color: #821874;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .nav-btn.active {
            background: #821874;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(130, 24, 116, 0.4);
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .panel.active {
            display: block;
        }

        .form-section {
            margin-bottom: 35px;
            border: 1px solid #ebebeb;
            border-radius: 12px;
            padding: 25px;
            background: #f4f4f4;
        }

        .form-section h3 {
            color: #821874;
            margin-bottom: 20px;
            font-size: 1.4em;
            border-bottom: 2px solid #821874;
            padding-bottom: 10px;
        }

        .question-group {
            margin-bottom: 20px;
        }

        .question-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d2d2d;
        }

        .radio-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 8px 12px;
            background: white;
            border-radius: 6px;
            border: 2px solid #ebebeb;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .radio-option:hover {
            border-color: #821874;
            background: #fef5fe;
        }

        .radio-option input[type="radio"] {
            margin: 0;
            accent-color: #821874;
        }

        .form-actions {
            text-align: center;
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid #ebebeb;
        }

        .btn {
            padding: 12px 30px;
            border: 2px solid transparent;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 10px;
        }

        .btn-primary {
            background: #821874;
            color: #ffffff;
            border-color: #821874;
        }

        .btn-primary:hover {
            background: rgba(130, 24, 116, 0.9);
            border-color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(130, 24, 116, 0.3);
        }

        .btn-secondary {
            background: #159eda;
            color: white;
            border-color: #159eda;
        }

        .btn-secondary:hover {
            background: rgba(21, 158, 218, 0.9);
            border-color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(21, 158, 218, 0.3);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .btn-danger:hover {
            background: rgba(220, 53, 69, 0.9);
            border-color: #ffffff;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 14px;
        }

        .status-overview {
            background: linear-gradient(135deg, #821874 0%, #159eda 100%);
            color: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .status-large {
            font-size: 3em;
            font-weight: 700;
            margin: 20px 0;
        }

        .progress-ring {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            position: relative;
        }

        .progress-ring svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 15;
        }

        .progress-ring .background {
            stroke: rgba(255, 255, 255, 0.3);
        }

        .progress-ring .progress {
            stroke: #7EBEC5;
            stroke-linecap: round;
            transition: stroke-dasharray 1s ease-in-out;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2em;
            font-weight: 700;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #ebebeb;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 600;
            color: #2d2d2d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab:hover {
            color: #821874;
        }

        .tab.active {
            color: #821874;
            border-bottom-color: #821874;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dimension-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #ebebeb;
        }

        .dimension-card h4 {
            color: #821874;
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .progress-container {
            position: relative;
            background: #f4f4f4;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-bar {
            height: 100%;
            border-radius: 15px;
            transition: width 0.8s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .status-novice { background: linear-gradient(45deg, #dc3545, #c82333); }
        .status-emerging { background: linear-gradient(45deg, #fd7e14, #e55a00); }
        .status-developing { background: linear-gradient(45deg, #ffc107, #e0a800); }
        .status-advanced { background: linear-gradient(45deg, #7EBEC5, #159eda); }

        .status-label {
            font-size: 14px;
            font-weight: 600;
            text-align: center;
        }

        .detailed-results {
            margin-top: 30px;
        }

        .dimension-detail {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid #ebebeb;
        }

        .dimension-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #821874;
        }

        .dimension-score {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }

        .score-value {
            font-size: 2em;
            font-weight: 700;
            color: #821874;
        }

        .score-details {
            font-size: 0.9em;
            color: #2d2d2d;
        }

        .questions-list {
            margin-top: 20px;
        }

        .question-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f4f4f4;
            border-radius: 8px;
            border-left: 4px solid #821874;
        }

        .question-text {
            flex: 1;
            font-weight: 500;
            margin-right: 20px;
        }

        .question-response {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .response-value {
            background: #821874;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            min-width: 40px;
            text-align: center;
        }

        .response-text {
            font-size: 0.9em;
            color: #2d2d2d;
        }

        .saved-assessments {
            margin-bottom: 20px;
        }

        .assessment-item {
            background: white;
            border: 1px solid #ebebeb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .assessment-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="date"],
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ebebeb;
            border-radius: 8px;
            margin-bottom: 15px;
            font-family: inherit;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus,
        input[type="date"]:focus,
        select:focus {
            outline: none;
            border-color: #821874;
            box-shadow: 0 0 0 3px rgba(130, 24, 116, 0.1);
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
            }

            .logo {
                height: 50px;
                margin-bottom: 15px;
            }

            .header-text {
                padding: 0;
            }

            .header-text h1 {
                font-size: 1.5em;
            }

            .navigation {
                flex-direction: column;
                align-items: center;
            }
            
            .radio-group {
                flex-direction: column;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .dimension-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .question-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .progress-ring {
                width: 150px;
                height: 150px;
            }
            
            .status-large {
                font-size: 2em;
            }

            .assessment-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .assessment-actions {
                width: 100%;
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <img src="https://mega.kaizenacademy.education/images/mega_logo.png" alt="MEGA Logo" class="logo">
            </div>
            <div class="header-text">
                <h1>LEAN Assessment Tool</h1>
                <p>Comprehensive evaluation of your organization's LEAN maturity</p>
            </div>
        </div>

        <!-- User Management -->
        <div id="loginSection" class="panel active" style="display: block;">
            <div style="max-width: 400px; margin: 0 auto; text-align: center;">
                <h2 style="color: #821874;">User Access</h2>
                <p>Please identify yourself to access your assessments</p>
                
                <div class="data-warning">
                    <h4>âœ… Cloud Storage - Powered by Supabase</h4>
                    <p><strong>Your assessments are stored securely in the cloud!</strong> Access them from any device by logging in with the same email address.</p>
                </div>
                
                <div style="margin: 30px 0;">
                    <label for="userEmail" style="display: block; margin-bottom: 10px; font-weight: 600; text-align: left;">Email Address:</label>
                    <input type="email" id="userEmail" placeholder="Enter your email">
                    
                    <label for="userRole" style="display: block; margin-bottom: 10px; font-weight: 600; text-align: left;">Access Level:</label>
                    <select id="userRole">
                        <option value="user">Regular User</option>
                        <option value="admin">Administrator</option>
                    </select>
                    
                    <div id="adminPassword" style="display: none;">
                        <label for="adminPass" style="display: block; margin-bottom: 10px; font-weight: 600; text-align: left;">Admin Password:</label>
                        <input type="password" id="adminPass" placeholder="Enter admin password">
                    </div>
                    
                    <button class="btn btn-primary" onclick="userLogin()" style="width: 100%; margin-top: 10px;">Access Assessments</button>
                </div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #ebebeb; font-size: 14px; color: #2d2d2d;">
                    <p><strong>Regular Users:</strong> Create and manage your own assessments</p>
                    <p><strong>Administrators:</strong> View all assessments and organization analytics</p>
                </div>
            </div>
        </div>

        <!-- Navigation (hidden until logged in) -->
        <div class="navigation" id="mainNavigation" style="display: none;">
            <button class="nav-btn active" onclick="showPanel('assessment')">New Assessment</button>
            <button class="nav-btn" onclick="showPanel('dashboard')">My Dashboard</button>
            <button class="nav-btn" onclick="showPanel('saved')">My Assessments</button>
            <button class="nav-btn" id="adminNav" onclick="showPanel('admin')" style="display: none;">Admin Panel</button>
            <button class="nav-btn btn-danger" onclick="userLogout()">Logout</button>
        </div>

        <!-- Assessment Panel -->
        <div id="assessmentPanel" class="panel">
            <div class="data-warning">
                <h4>Assessment Guidelines</h4>
                <p><strong>Please allow 30-45 minutes</strong> to complete this assessment. Answer honestly based on your organization's current state. Your progress is automatically saved to the cloud.</p>
            </div>

            <form id="assessmentForm">
                <div class="form-section">
                    <h3>Company Information</h3>
                    <div class="question-group">
                        <label for="companyName">Company Name:</label>
                        <input type="text" id="companyName" name="companyName" required>
                    </div>
                    <div class="question-group">
                        <label for="assessorName">Assessor Name:</label>
                        <input type="text" id="assessorName" name="assessorName" required>
                    </div>
                    <div class="question-group">
                        <label for="assessmentDate">Assessment Date:</label>
                        <input type="date" id="assessmentDate" name="assessmentDate" required>
                    </div>
                </div>

                <!-- Leadership & Culture -->
                <div class="form-section">
                    <h3>1. Leadership & Culture (Questions 1-5)</h3>
                    <p style="color: #2d2d2d; margin-bottom: 20px;">Evaluates how well leadership promotes LEAN principles and creates a culture of continuous improvement.</p>
                    
                    <div class="question-group">
                        <label>Q1: Leaders actively promote LEAN principles across all levels.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q1" value="1"> <span>1 - Strongly Disagree</span></div>
                            <div class="radio-option"><input type="radio" name="q1" value="2"> <span>2 - Disagree</span></div>
                            <div class="radio-option"><input type="radio" name="q1" value="3"> <span>3 - Neutral</span></div>
                            <div class="radio-option"><input type="radio" name="q1" value="4"> <span>4 - Agree</span></div>
                            <div class="radio-option"><input type="radio" name="q1" value="5"> <span>5 - Strongly Agree</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q2: Continuous improvement is embedded in our organizational culture.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q2" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q2" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q2" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q2" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q2" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q3: Employees are empowered to identify and solve problems.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q3" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q3" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q3" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q3" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q3" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q4: LEAN thinking is part of strategic decision-making.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q4" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q4" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q4" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q4" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q4" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q5: Failures are treated as learning opportunities.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q5" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q5" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q5" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q5" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q5" value="5"> <span>5</span></div>
                        </div>
                    </div>
                </div>

                <!-- Customer Value Focus -->
                <div class="form-section">
                    <h3>2. Customer Value Focus (Questions 6-10)</h3>
                    <p style="color: #2d2d2d; margin-bottom: 20px;">Measures how well your organization understands and delivers customer value.</p>
                    
                    <div class="question-group">
                        <label>Q6: We clearly understand what our customers value most.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q6" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q6" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q6" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q6" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q6" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q7: Processes are designed to maximize customer value.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q7" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q7" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q7" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q7" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q7" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q8: Feedback loops from customers are frequent and actionable.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q8" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q8" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q8" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q8" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q8" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q9: Waste that does not add customer value is systematically eliminated.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q9" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q9" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q9" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q9" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q9" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q10: We regularly review our offerings to align with evolving customer needs.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q10" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q10" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q10" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q10" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q10" value="5"> <span>5</span></div>
                        </div>
                    </div>
                </div>

                <!-- Process Efficiency (Q11-15) -->
                <div class="form-section">
                    <h3>3. Process Efficiency (Questions 11-15)</h3>
                    <p style="color: #2d2d2d; margin-bottom: 20px;">Assesses standardization, bottleneck management, and process optimization.</p>
                    
                    <div class="question-group">
                        <label>Q11: Standardized work is documented and followed consistently.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q11" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q11" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q11" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q11" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q11" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q12: Bottlenecks and inefficiencies are quickly identified and addressed.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q12" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q12" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q12" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q12" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q12" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q13: Visual management tools are used effectively.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q13" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q13" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q13" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q13" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q13" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q14: Value stream mapping is used to optimize workflows.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q14" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q14" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q14" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q14" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q14" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q15: We use metrics to monitor and improve process performance.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q15" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q15" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q15" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q15" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q15" value="5"> <span>5</span></div>
                        </div>
                    </div>
                </div>

                <!-- Waste Elimination (Q16-20) -->
                <div class="form-section">
                    <h3>4. Waste Elimination - Muda (Questions 16-20)</h3>
                    <p style="color: #2d2d2d; margin-bottom: 20px;">Reviews your ability to identify and eliminate the 8 types of waste.</p>
                    
                    <div class="question-group">
                        <label>Q16: We actively identify and eliminate the 8 types of waste.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q16" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q16" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q16" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q16" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q16" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q17: Employees are trained to recognize waste in their daily work.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q17" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q17" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q17" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q17" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q17" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q18: Waste reduction initiatives are tracked and reviewed.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q18" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q18" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q18" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q18" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q18" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q19: Inventory levels are optimized to reduce excess.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q19" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q19" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q19" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q19" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q19" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q20: We use 5S to maintain organized and efficient workspaces.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q20" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q20" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q20" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q20" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q20" value="5"> <span>5</span></div>
                        </div>
                    </div>
                </div>

                <!-- Continuous Improvement (Q21-25) -->
                <div class="form-section">
                    <h3>5. Continuous Improvement - Kaizen (Questions 21-25)</h3>
                    <p style="color: #2d2d2d; margin-bottom: 20px;">Evaluates your Kaizen culture and improvement practices.</p>
                    
                    <div class="question-group">
                        <label>Q21: Improvement ideas are regularly submitted by frontline staff.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q21" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q21" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q21" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q21" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q21" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q22: Cross-functional teams work on improvement projects.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q22" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q22" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q22" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q22" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q22" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q23: PDCA (Plan-Do-Check-Act) cycles are used consistently.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q23" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q23" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q23" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q23" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q23" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q24: Improvements are documented and shared across teams.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q24" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q24" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q24" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q24" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q24" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q25: We celebrate and recognize successful improvement efforts.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q25" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q25" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q25" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q25" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q25" value="5"> <span>5</span></div>
                        </div>
                    </div>
                </div>

                <!-- Flow and Pull Systems (Q26-30) -->
                <div class="form-section">
                    <h3>6. Flow and Pull Systems (Questions 26-30)</h3>
                    <p style="color: #2d2d2d; margin-bottom: 20px;">Assesses workflow optimization and pull system implementation.</p>
                    
                    <div class="question-group">
                        <label>Q26: Work flows smoothly with minimal interruptions.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q26" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q26" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q26" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q26" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q26" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q27: We use pull systems (e.g., Kanban) to manage work-in-progress.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q27" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q27" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q27" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q27" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q27" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q28: Production is based on actual demand, not forecasts.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q28" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q28" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q28" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q28" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q28" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q29: Setup times are minimized to support flow.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q29" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q29" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q29" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q29" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q29" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q30: We balance workloads to avoid overburdening teams.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q30" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q30" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q30" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q30" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q30" value="5"> <span>5</span></div>
                        </div>
                    </div>
                </div>

                <!-- Problem Solving (Q31-35) -->
                <div class="form-section">
                    <h3>7. Problem Solving & Root Cause Analysis (Questions 31-35)</h3>
                    <p style="color: #2d2d2d; margin-bottom: 20px;">Reviews structured problem-solving capabilities.</p>
                    
                    <div class="question-group">
                        <label>Q31: Structured problem-solving methods (e.g., A3, 5 Whys) are used.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q31" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q31" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q31" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q31" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q31" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q32: Problems are addressed at the source, not just symptoms.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q32" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q32" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q32" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q32" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q32" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q33: Data is used to support root cause analysis.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q33" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q33" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q33" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q33" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q33" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q34: Corrective actions are tracked for effectiveness.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q34" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q34" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q34" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q34" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q34" value="5"> <span>5</span></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label>Q35: Teams are trained in problem-solving techniques.</label>
                        <div class="radio-group">
                            <div class="radio-option"><input type="radio" name="q35" value="1"> <span>1</span></div>
                            <div class="radio-option"><input type="radio" name="q35" value="2"> <span>2</span></div>
                            <div class="radio-option"><input type="radio" name="q35" value="3"> <span>3</span></div>
                            <div class="radio-option"><input type="radio" name="q35" value="4"> <span>4</span></div>
                            <div class="radio-option"><input type="radio" name="q35" value="5"> <span>5</span></div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-primary" onclick="submitAssessment()">Submit Assessment</button>
                    <button type="button" class="btn btn-secondary" onclick="saveAssessment()">Save Draft</button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">Reset Form</button>
                </div>
            </form>
        </div>

        <!-- Dashboard Panel -->
        <div id="dashboardPanel" class="panel">
            <div class="status-overview">
                <h2>LEAN Maturity Assessment Results</h2>
                <div class="progress-ring">
                    <svg>
                        <circle class="background" cx="100" cy="100" r="85"></circle>
                        <circle class="progress" cx="100" cy="100" r="85" id="progressCircle"></circle>
                    </svg>
                    <div class="progress-text" id="progressText">0%</div>
                </div>
                <div class="status-large" id="statusLarge">Not Assessed</div>
                <div id="statusDescription">Complete an assessment to see your organization's LEAN maturity level</div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="showTab('overview')">Overview</button>
                <button class="tab" onclick="showTab('detailed')">Detailed Analysis</button>
                <button class="tab" onclick="showTab('questions')">Question Responses</button>
            </div>

            <div id="overviewTab" class="tab-content active">
                <div class="results-grid" id="enhancedResultsGrid"></div>
                <div style="height: 300px; margin: 20px 0;">
                    <canvas id="comparisonChart" width="800" height="300"></canvas>
                </div>
            </div>

            <div id="detailedTab" class="tab-content">
                <div class="detailed-results" id="detailedResults"></div>
            </div>

            <div id="questionsTab" class="tab-content">
                <div id="questionResponses"></div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-primary" onclick="window.print()">Print Report</button>
                <button type="button" class="btn btn-secondary" onclick="exportResults()">Export Results</button>
            </div>
        </div>

        <!-- Saved Assessments Panel -->
        <div id="savedPanel" class="panel">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 id="savedTitle" style="color: #821874;">My Assessments</h2>
                <div>
                    <span id="userInfo" style="color: #2d2d2d; font-size: 14px;"></span>
                </div>
            </div>
            
            <div class="data-warning">
                <h4>âœ… Cloud Storage Benefits</h4>
                <p>Your assessments are securely stored in the Supabase cloud. Access them from any device!</p>
            </div>

            <div class="saved-assessments" id="savedAssessments"></div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPanel" class="panel">
            <h2 style="color: #821874;">Administrator Dashboard</h2>
            
            <div style="margin-bottom: 30px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div class="dimension-card" style="text-align: center;">
                        <h4>Total Organizations</h4>
                        <div style="font-size: 2em; font-weight: 700; color: #821874;" id="totalOrgs">0</div>
                    </div>
                    <div class="dimension-card" style="text-align: center;">
                        <h4>Total Assessments</h4>
                        <div style="font-size: 2em; font-weight: 700; color: #821874;" id="totalAssessments">0</div>
                    </div>
                    <div class="dimension-card" style="text-align: center;">
                        <h4>Average Score</h4>
                        <div style="font-size: 2em; font-weight: 700; color: #821874;" id="avgScore">0%</div>
                    </div>
                    <div class="dimension-card" style="text-align: center;">
                        <h4>Most Common Status</h4>
                        <div style="font-size: 1.5em; font-weight: 700; color: #821874;" id="commonStatus">N/A</div>
                    </div>
                </div>
            </div>
            
            <h3 style="color: #821874;">All Organization Assessments</h3>
            <div class="saved-assessments" id="adminAssessments"></div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-primary" onclick="exportAllData()">Export All Data</button>
            </div>
        </div>
    </div>

    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://hammdlesdcmenhronfml.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhhbW1kbGVzZGNtZW5ocm9uZm1sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIwMzUwMTYsImV4cCI6MjA3NzYxMTAxNn0.pFmZoSrCLCSMLrbBmTh3L-MMdJ6GL-5G-NKDr4YIV6g';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        console.log("âœ… Supabase initialized successfully!");
        
        // User Management System
        const ADMIN_PASSWORD = "mega2025";
        let currentUser = null;
        let currentAssessmentId = null;

        // Question labels for detailed view
        const questionLabels = {
            1: "Leaders actively promote LEAN principles across all levels.",
            2: "Continuous improvement is embedded in our organizational culture.",
            3: "Employees are empowered to identify and solve problems.",
            4: "LEAN thinking is part of strategic decision-making.",
            5: "Failures are treated as learning opportunities.",
            6: "We clearly understand what our customers value most.",
            7: "Processes are designed to maximize customer value.",
            8: "Feedback loops from customers are frequent and actionable.",
            9: "Waste that does not add customer value is systematically eliminated.",
            10: "We regularly review our offerings to align with evolving customer needs.",
            11: "Standardized work is documented and followed consistently.",
            12: "Bottlenecks and inefficiencies are quickly identified and addressed.",
            13: "Visual management tools are used effectively.",
            14: "Value stream mapping is used to optimize workflows.",
            15: "We use metrics to monitor and improve process performance.",
            16: "We actively identify and eliminate the 8 types of waste.",
            17: "Employees are trained to recognize waste in their daily work.",
            18: "Waste reduction initiatives are tracked and reviewed.",
            19: "Inventory levels are optimized to reduce excess.",
            20: "We use 5S to maintain organized and efficient workspaces.",
            21: "Improvement ideas are regularly submitted by frontline staff.",
            22: "Cross-functional teams work on improvement projects.",
            23: "PDCA (Plan-Do-Check-Act) cycles are used consistently.",
            24: "Improvements are documented and shared across teams.",
            25: "We celebrate and recognize successful improvement efforts.",
            26: "Work flows smoothly with minimal interruptions.",
            27: "We use pull systems (e.g., Kanban) to manage work-in-progress.",
            28: "Production is based on actual demand, not forecasts.",
            29: "Setup times are minimized to support flow.",
            30: "We balance workloads to avoid overburdening teams.",
            31: "Structured problem-solving methods (e.g., A3, 5 Whys) are used.",
            32: "Problems are addressed at the source, not just symptoms.",
            33: "Data is used to support root cause analysis.",
            34: "Corrective actions are tracked for effectiveness.",
            35: "Teams are trained in problem-solving techniques."
        };

        const responseLabels = {
            1: "Strongly Disagree",
            2: "Disagree", 
            3: "Neutral",
            4: "Agree",
            5: "Strongly Agree"
        };

        // Assessment data structure
        const dimensions = [
            { id: 'leadership', name: 'Leadership & Culture', questions: [1, 2, 3, 4, 5] },
            { id: 'customer', name: 'Customer Value Focus', questions: [6, 7, 8, 9, 10] },
            { id: 'process', name: 'Process Efficiency', questions: [11, 12, 13, 14, 15] },
            { id: 'waste', name: 'Waste Elimination', questions: [16, 17, 18, 19, 20] },
            { id: 'improvement', name: 'Continuous Improvement', questions: [21, 22, 23, 24, 25] },
            { id: 'flow', name: 'Flow and Pull Systems', questions: [26, 27, 28, 29, 30] },
            { id: 'problem', name: 'Problem Solving & Root Cause Analysis', questions: [31, 32, 33, 34, 35] }
        ];

        // User Login
        async function userLogin() {
            const email = document.getElementById('userEmail').value.trim();
            const role = document.getElementById('userRole').value;
            const adminPass = document.getElementById('adminPass').value;

            if (!email) {
                alert('Please enter your email address.');
                return;
            }

            if (role === 'admin' && adminPass !== ADMIN_PASSWORD) {
                alert('Incorrect admin password.');
                return;
            }

            currentUser = {
                email: email,
                role: role,
                loginTime: new Date().toISOString()
            };

            sessionStorage.setItem('currentUser', JSON.stringify(currentUser));

            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('mainNavigation').style.display = 'flex';
            
            if (role === 'admin') {
                document.getElementById('adminNav').style.display = 'block';
            }

            updateUserInfo();
            showPanel('assessment');
            await loadUserAssessments();
        }

        function userLogout() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                sessionStorage.removeItem('currentUser');
                
                document.getElementById('loginSection').style.display = 'block';
                document.getElementById('mainNavigation').style.display = 'none';
                document.getElementById('adminNav').style.display = 'none';
                
                document.querySelectorAll('.panel').forEach(panel => {
                    panel.classList.remove('active');
                });
                document.getElementById('loginSection').classList.add('active');
                
                document.getElementById('userEmail').value = '';
                document.getElementById('userRole').value = 'user';
                document.getElementById('adminPass').value = '';
                document.getElementById('adminPassword').style.display = 'none';
            }
        }

        function updateUserInfo() {
            if (currentUser) {
                document.getElementById('userInfo').textContent = 
                    `Logged in as: ${currentUser.email} (${currentUser.role === 'admin' ? 'Administrator' : 'User'})`;
            }
        }

        function checkUserSession() {
            const savedUser = sessionStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('mainNavigation').style.display = 'flex';
                
                if (currentUser.role === 'admin') {
                    document.getElementById('adminNav').style.display = 'block';
                }
                
                updateUserInfo();
                showPanel('assessment');
                return true;
            }
            return false;
        }

        // Supabase Functions
        async function saveAssessmentToStorage(assessment) {
            if (!currentUser) {
                alert('Please login first.');
                return;
            }

            try {
                if (assessment.id) {
                    // Update existing
                    const { data: existing, error: fetchError } = await supabase
                        .from('assessments')
                        .select('*')
                        .eq('id', assessment.id)
                        .single();
                    
                    if (fetchError) {
                        alert('Error loading assessment: ' + fetchError.message);
                        return;
                    }
                    
                    // Check permissions
                    if (currentUser.role !== 'admin' && existing.user_email !== currentUser.email) {
                        alert('You can only edit your own assessments.');
                        return;
                    }
                    
                    // Add to edit history
                    const editHistory = existing.edit_history || [];
                    editHistory.push({
                        timestamp: new Date().toISOString(),
                        action: 'Updated',
                        user_email: currentUser.email
                    });
                    
                    // Update
                    const { data, error } = await supabase
                        .from('assessments')
                        .update({
                            company_name: assessment.companyName,
                            assessor_name: assessment.assessorName,
                            assessment_date: assessment.assessmentDate,
                            responses: assessment.responses,
                            results: assessment.results,
                            is_draft: assessment.isDraft || false,
                            edit_history: editHistory
                        })
                        .eq('id', assessment.id);
                    
                    if (error) {
                        alert('Error updating: ' + error.message);
                        return;
                    }
                    
                    alert('Assessment updated successfully!');
                } else {
                    // Create new
                    const newAssessment = {
                        id: Date.now(),
                        user_email: currentUser.email,
                        user_name: currentUser.email.split('@')[0],
                        company_name: assessment.companyName,
                        assessor_name: assessment.assessorName,
                        assessment_date: assessment.assessmentDate,
                        responses: assessment.responses,
                        results: assessment.results,
                        is_draft: assessment.isDraft || false,
                        timestamp: new Date().toISOString(),
                        edit_history: []
                    };
                    
                    const { data, error } = await supabase
                        .from('assessments')
                        .insert([newAssessment]);
                    
                    if (error) {
                        alert('Error saving: ' + error.message);
                        return;
                    }
                    
                    alert('Assessment saved successfully!');
                }
            } catch (error) {
                alert('Unexpected error: ' + error.message);
            }
        }

        async function getUserAssessments() {
            if (!currentUser) return [];
            
            try {
                let query = supabase
                    .from('assessments')
                    .select('*')
                    .order('timestamp', { ascending: false });
                
                // Regular users see only their own
                if (currentUser.role !== 'admin') {
                    query = query.eq('user_email', currentUser.email);
                }
                
                const { data, error } = await query;
                
                if (error) {
                    console.error('Error loading assessments:', error);
                    return [];
                }
                
                // Convert snake_case to camelCase
                return data.map(assessment => ({
                    id: assessment.id,
                    userEmail: assessment.user_email,
                    userName: assessment.user_name,
                    companyName: assessment.company_name,
                    assessorName: assessment.assessor_name,
                    assessmentDate: assessment.assessment_date,
                    responses: assessment.responses,
                    results: assessment.results,
                    isDraft: assessment.is_draft,
                    timestamp: assessment.timestamp,
                    editHistory: assessment.edit_history,
                    createdAt: assessment.created_at,
                    updatedAt: assessment.updated_at
                }));
            } catch (error) {
                console.error('Error:', error);
                return [];
            }
        }

        async function deleteAssessment(id) {
            try {
                const { data: assessment, error: fetchError } = await supabase
                    .from('assessments')
                    .select('*')
                    .eq('id', id)
                    .single();
                
                if (fetchError) {
                    alert('Assessment not found.');
                    return;
                }
                
                // Check permission
                if (currentUser.role !== 'admin' && assessment.user_email !== currentUser.email) {
                    alert('You can only delete your own assessments.');
                    return;
                }
                
                if (confirm('Are you sure you want to delete this assessment?')) {
                    const { error } = await supabase
                        .from('assessments')
                        .delete()
                        .eq('id', id);
                    
                    if (error) {
                        alert('Error deleting: ' + error.message);
                        return;
                    }
                    
                    alert('Deleted successfully!');
                    await loadSavedAssessments();
                    
                    if (currentUser.role === 'admin') {
                        await loadAdminDashboard();
                    }
                }
            } catch (error) {
                alert('Unexpected error: ' + error.message);
            }
        }

        async function loadAssessment(id) {
            try {
                const { data: assessment, error } = await supabase
                    .from('assessments')
                    .select('*')
                    .eq('id', id)
                    .single();
                
                if (error) {
                    alert('Assessment not found.');
                    return;
                }
                
                // Check permission
                if (currentUser.role !== 'admin' && assessment.user_email !== currentUser.email) {
                    alert('You can only edit your own assessments.');
                    return;
                }
                
                if (assessment && assessment.responses) {
                    currentAssessmentId = assessment.id;
                    
                    // Load form data
                    document.getElementById('companyName').value = assessment.responses.companyName || '';
                    document.getElementById('assessorName').value = assessment.responses.assessorName || '';
                    document.getElementById('assessmentDate').value = assessment.responses.assessmentDate || '';
                    
                    // Load question responses
                    for (let i = 1; i <= 35; i++) {
                        if (assessment.responses[`q${i}`]) {
                            const radio = document.querySelector(`input[name="q${i}"][value="${assessment.responses[`q${i}`]}"]`);
                            if (radio) {
                                radio.checked = true;
                                radio.closest('.radio-option').style.background = '#fef5fe';
                                radio.closest('.radio-option').style.borderColor = '#821874';
                            }
                        }
                    }
                    
                    showPanel('assessment');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function submitAssessment() {
            if (!validateAssessment()) {
                alert('Please answer all questions.');
                return;
            }

            const results = calculateResults();
            const assessment = {
                id: currentAssessmentId || Date.now(),
                companyName: document.getElementById('companyName').value,
                assessorName: document.getElementById('assessorName').value,
                assessmentDate: document.getElementById('assessmentDate').value,
                results: results,
                responses: getFormResponses(),
                isDraft: false
            };

            await saveAssessmentToStorage(assessment);
            
            currentAssessmentId = null;
            document.getElementById('assessmentForm').reset();
            
            await loadDashboard();
            showPanel('dashboard');
        }

        async function saveAssessment() {
            const assessment = {
                id: currentAssessmentId || Date.now(),
                companyName: document.getElementById('companyName').value,
                assessorName: document.getElementById('assessorName').value,
                assessmentDate: document.getElementById('assessmentDate').value,
                isDraft: true,
                responses: getFormResponses()
            };

            await saveAssessmentToStorage(assessment);
        }

        function validateAssessment() {
            for (let i = 1; i <= 35; i++) {
                if (!document.querySelector(`input[name="q${i}"]:checked`)) {
                    return false;
                }
            }
            return document.getElementById('companyName').value && 
                   document.getElementById('assessorName').value && 
                   document.getElementById('assessmentDate').value;
        }

        function getFormResponses() {
            const responses = {};
            responses.companyName = document.getElementById('companyName').value;
            responses.assessorName = document.getElementById('assessorName').value;
            responses.assessmentDate = document.getElementById('assessmentDate').value;
            
            for (let i = 1; i <= 35; i++) {
                const checked = document.querySelector(`input[name="q${i}"]:checked`);
                responses[`q${i}`] = checked ? parseInt(checked.value) : 0;
            }
            
            return responses;
        }

        function calculateResults() {
            const results = {};
            let totalScore = 0;
            
            dimensions.forEach(dimension => {
                let dimensionScore = 0;
                dimension.questions.forEach(qNum => {
                    const checked = document.querySelector(`input[name="q${qNum}"]:checked`);
                    if (checked) {
                        dimensionScore += parseInt(checked.value);
                    }
                });
                
                const percentage = Math.round((dimensionScore / 25) * 100);
                const status = getLEANStatus(percentage);
                
                results[dimension.id] = {
                    name: dimension.name,
                    score: dimensionScore,
                    maxScore: 25,
                    percentage: percentage,
                    status: status
                };
                
                totalScore += dimensionScore;
            });
            
            results.total = {
                score: totalScore,
                maxScore: 175,
                percentage: Math.round((totalScore / 175) * 100),
                status: getLEANStatus(Math.round((totalScore / 175) * 100))
            };
            
            return results;
        }

        function getLEANStatus(percentage) {
            if (percentage <= 31) return 'Novice';
            if (percentage <= 48) return 'Emerging';
            if (percentage <= 66) return 'Developing';
            return 'Advanced';
        }

        function getStatusColor(status) {
            switch (status) {
                case 'Novice': return 'status-novice';
                case 'Emerging': return 'status-emerging';
                case 'Developing': return 'status-developing';
                case 'Advanced': return 'status-advanced';
                default: return 'status-novice';
            }
        }

        function resetForm() {
            if (confirm('Are you sure you want to reset the form? All current answers will be lost.')) {
                document.getElementById('assessmentForm').reset();
                document.getElementById('assessmentDate').value = new Date().toISOString().split('T')[0];
                currentAssessmentId = null;
            }
        }

        async function loadUserAssessments() {
            const userAssessments = await getUserAssessments();
            
            const title = document.getElementById('savedTitle');
            if (currentUser.role === 'admin') {
                title.textContent = `All Assessments (${userAssessments.length})`;
            } else {
                title.textContent = `My Assessments (${userAssessments.length})`;
            }
        }

        // Dashboard Functions
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            event.target.classList.add('active');
        }

        function updateStatusOverview(totalResults) {
            const progressText = document.getElementById('progressText');
            const statusLarge = document.getElementById('statusLarge');
            const statusDescription = document.getElementById('statusDescription');
            const progressCircle = document.getElementById('progressCircle');
            
            progressText.textContent = totalResults.percentage + '%';
            statusLarge.textContent = totalResults.status;
            
            const descriptions = {
                'Novice': 'LEAN awareness exists, but implementation is limited. Focus on foundation building.',
                'Emerging': 'LEAN practices are emerging but not yet consistent. Work on practice development.',
                'Developing': 'Strong LEAN foundation with room for refinement. Focus on system integration.',
                'Advanced': 'LEAN is deeply embedded and continuously evolving. Maintain excellence.'
            };
            statusDescription.textContent = descriptions[totalResults.status] || '';
            
            const circumference = 2 * Math.PI * 85;
            const offset = circumference - (totalResults.percentage / 100) * circumference;
            progressCircle.style.strokeDasharray = circumference;
            progressCircle.style.strokeDashoffset = offset;
            
            const colors = {
                'Novice': '#dc3545',
                'Emerging': '#fd7e14', 
                'Developing': '#ffc107',
                'Advanced': '#7EBEC5'
            };
            progressCircle.style.stroke = colors[totalResults.status] || '#7EBEC5';
        }

        function updateEnhancedResultsGrid(results) {
            const grid = document.getElementById('enhancedResultsGrid');
            grid.innerHTML = '';
            
            dimensions.forEach(dimension => {
                const result = results[dimension.id];
                const card = document.createElement('div');
                card.className = 'dimension-card';
                
                card.innerHTML = `
                    <h4>${result.name}</h4>
                    <div class="progress-container">
                        <div class="progress-bar ${getStatusColor(result.status)}" style="width: ${result.percentage}%">
                            ${result.percentage}%
                        </div>
                    </div>
                    <div class="status-label ${getStatusColor(result.status)}">${result.status}</div>
                    <div style="font-size: 14px; color: #2d2d2d; margin-top: 5px;">
                        Score: ${result.score}/25
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        function updateDetailedAnalysis(results, responses) {
            const container = document.getElementById('detailedResults');
            container.innerHTML = '';
            
            dimensions.forEach(dimension => {
                const result = results[dimension.id];
                const div = document.createElement('div');
                div.className = 'dimension-detail';
                
                div.innerHTML = `
                    <div class="dimension-header">
                        <h3>${result.name}</h3>
                        <div class="dimension-score">
                            <div class="score-value">${result.percentage}%</div>
                            <div class="score-details">${result.score}/25 points</div>
                            <div class="score-details">${result.status}</div>
                        </div>
                    </div>
                    <div class="questions-list">
                        ${dimension.questions.map(qNum => {
                            const response = responses[`q${qNum}`] || 0;
                            return `
                                <div class="question-item">
                                    <div class="question-text">Q${qNum}: ${questionLabels[qNum]}</div>
                                    <div class="question-response">
                                        <div class="response-value">${response}</div>
                                        <div class="response-text">${responseLabels[response] || 'No Response'}</div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                
                container.appendChild(div);
            });
        }

        function updateQuestionResponses(responses) {
            const container = document.getElementById('questionResponses');
            container.innerHTML = '';
            
            dimensions.forEach(dimension => {
                const div = document.createElement('div');
                div.className = 'dimension-detail';
                
                let totalScore = 0;
                const questionsList = dimension.questions.map(qNum => {
                    const response = responses[`q${qNum}`] || 0;
                    totalScore += response;
                    
                    return `
                        <div class="question-item">
                            <div class="question-text">
                                <strong>Question ${qNum}:</strong> ${questionLabels[qNum]}
                            </div>
                            <div class="question-response">
                                <div class="response-value">${response}</div>
                                <div class="response-text">${responseLabels[response] || 'No Response'}</div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                const percentage = Math.round((totalScore / 25) * 100);
                const status = getLEANStatus(percentage);
                
                div.innerHTML = `
                    <div class="dimension-header">
                        <h3>${dimension.name}</h3>
                        <div class="dimension-score">
                            <div class="score-value">${percentage}%</div>
                            <div class="score-details">${totalScore}/25 points</div>
                            <div class="score-details">${status}</div>
                        </div>
                    </div>
                    ${questionsList}
                `;
                
                container.appendChild(div);
            });
        }

        function updateComparisonChart(results) {
            const canvas = document.getElementById('comparisonChart');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            const margin = 50;
            const chartWidth = width - margin * 2;
            const chartHeight = height - margin * 2;
            const barWidth = chartWidth / dimensions.length;
            
            ctx.fillStyle = '#821874';
            ctx.font = 'bold 16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Dimension Comparison', width / 2, 25);
            
            dimensions.forEach((dimension, index) => {
                const result = results[dimension.id];
                const barHeight = (result.percentage / 100) * chartHeight;
                const x = margin + index * barWidth;
                const y = height - margin - barHeight;
                
                const colors = {
                    'Novice': '#dc3545',
                    'Emerging': '#fd7e14',
                    'Developing': '#ffc107',
                    'Advanced': '#7EBEC5'
                };
                
                ctx.fillStyle = colors[result.status] || '#ccc';
                ctx.fillRect(x + 10, y, barWidth - 20, barHeight);
                
                ctx.fillStyle = '#2d2d2d';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`${result.percentage}%`, x + barWidth/2, y - 10);
                
                ctx.save();
                ctx.translate(x + barWidth/2, height - 10);
                ctx.rotate(-Math.PI/6);
                ctx.font = '10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(dimension.name.split(' ')[0], 0, 0);
                ctx.restore();
            });
            
            ctx.fillStyle = '#2d2d2d';
            ctx.font = '10px Arial';
            ctx.textAlign = 'right';
            for (let i = 0; i <= 100; i += 20) {
                const y = height - margin - (i / 100) * chartHeight;
                ctx.fillText(i + '%', margin - 10, y + 3);
            }
        }

        async function loadDashboard() {
            await loadEnhancedDashboard();
        }

        async function loadEnhancedDashboard() {
            const userAssessments = await getUserAssessments();
            const latestAssessment = userAssessments
                .filter(a => !a.isDraft && a.results)
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))[0];
            
            if (!latestAssessment) {
                document.getElementById('progressText').textContent = '0%';
                document.getElementById('statusLarge').textContent = 'Not Assessed';
                document.getElementById('statusDescription').textContent = 'Complete an assessment to see your organization\'s LEAN maturity level';
                document.getElementById('enhancedResultsGrid').innerHTML = '<p style="text-align: center; color: #2d2d2d;">No completed assessments found. Please complete an assessment first.</p>';
                return;
            }
            
            const results = latestAssessment.results;
            
            updateStatusOverview(results.total);
            updateEnhancedResultsGrid(results);
            updateDetailedAnalysis(results, latestAssessment.responses);
            updateQuestionResponses(latestAssessment.responses);
            updateComparisonChart(results);
        }

        async function viewAssessment(id) {
            const userAssessments = await getUserAssessments();
            const assessment = userAssessments.find(a => a.id.toString() === id.toString());
            
            if (assessment && assessment.results) {
                updateStatusOverview(assessment.results.total);
                updateEnhancedResultsGrid(assessment.results);
                updateDetailedAnalysis(assessment.results, assessment.responses);
                updateQuestionResponses(assessment.responses);
                updateComparisonChart(assessment.results);
                showPanel('dashboard');
            } else {
                alert('This assessment is incomplete and cannot be viewed in the dashboard.');
            }
        }

        async function loadSavedAssessments() {
            const userAssessments = await getUserAssessments();
            const container = document.getElementById('savedAssessments');
            
            if (userAssessments.length === 0) {
                const noAssessmentsMsg = currentUser.role === 'admin' ? 
                    'No assessments found in the system.' : 
                    'No saved assessments found. Create your first assessment!';
                container.innerHTML = `<p style="text-align: center; color: #2d2d2d;">${noAssessmentsMsg}</p>`;
                return;
            }
            
            container.innerHTML = '';
            
            userAssessments.forEach(assessment => {
                const item = document.createElement('div');
                item.className = 'assessment-item';
                
                const status = assessment.isDraft ? 'Draft' : (assessment.results ? assessment.results.total.status : 'Incomplete');
                const score = assessment.results ? `${assessment.results.total.score}/175 (${assessment.results.total.percentage}%)` : 'N/A';
                
                const ownerInfo = currentUser.role === 'admin' ? 
                    `<p><strong>Owner:</strong> ${assessment.userEmail || 'Unknown'}</p>` : '';
                
                item.innerHTML = `
                    <div>
                        <h4 style="color: #821874;">${assessment.companyName || 'Unnamed Assessment'}</h4>
                        <p>Assessor: ${assessment.assessorName || 'N/A'} | Date: ${assessment.assessmentDate || 'N/A'}</p>
                        ${ownerInfo}
                        <p>Status: ${status} | Score: ${score}</p>
                        <small style="color: #2d2d2d;">Last modified: ${new Date(assessment.timestamp).toLocaleString()}</small>
                        ${assessment.editHistory && assessment.editHistory.length > 0 ? 
                            `<small style="display: block; color: #888;">Edits: ${assessment.editHistory.length}</small>` : ''}
                    </div>
                    <div class="assessment-actions">
                        <button class="btn btn-sm btn-primary" onclick="loadAssessment(${assessment.id})">Edit</button>
                        <button class="btn btn-sm btn-secondary" onclick="viewAssessment(${assessment.id})">View</button>
                        <button class="btn btn-sm btn-danger" onclick="deleteAssessment(${assessment.id})">Delete</button>
                    </div>
                `;
                
                container.appendChild(item);
            });
            
            await loadUserAssessments();
        }

        async function loadAdminDashboard() {
            if (currentUser.role !== 'admin') return;
            
            const allAssessments = await getUserAssessments();
            const completedAssessments = allAssessments.filter(a => !a.isDraft && a.results);
            
            const uniqueOrgs = [...new Set(allAssessments.map(a => a.companyName).filter(Boolean))];
            const totalOrgs = uniqueOrgs.length;
            const totalAssessments = completedAssessments.length;