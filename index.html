<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEGA LEAN Assessment Tool</title>
    <link rel="icon" type="image/x-icon" href="https://practitioner.kaizenacademy.education/Tcia.ico">
    <link rel="stylesheet" href="styles.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <img src="https://mega.kaizenacademy.education/images/mega_logo.png" alt="MEGA Logo" class="logo">
            </div>
            <div class="header-text">
                <h1>LEAN Assessment Tool</h1>
                <p>Comprehensive evaluation of your organization's LEAN maturity</p>
            </div>
        </div>

        <!-- AUTH SECTION -->
        <div id="authSection" class="panel active" style="display: block;">
            <div style="max-width: 500px; margin: 0 auto;">
                <div style="display: flex; gap: 10px; margin-bottom: 30px; border-bottom: 2px solid #ebebeb;">
                    <button class="auth-tab active" onclick="showAuthTab('signin')" id="signinTab">
                        Sign In
                    </button>
                    <button class="auth-tab" onclick="showAuthTab('signup')" id="signupTab">
                        Sign Up
                    </button>
                </div>

                <!-- Sign In Form -->
                <div id="signinForm" class="auth-form" style="display: block;">
                    <h2 style="color: #821874; text-align: center;">Welcome Back</h2>
                    <p style="text-align: center;">Sign in to access your assessments</p>
                    
                    <div class="data-warning">
                        <h4>‚òÅÔ∏è Cloud Storage - Powered by Firebase</h4>
                        <p><strong>Your assessments are stored securely in the cloud!</strong> Access them from any device.</p>
                    </div>
                    
                    <div style="margin: 30px 0;">
                        <label for="signinEmail" style="display: block; margin-bottom: 10px; font-weight: 600;">Email Address:</label>
                        <input type="email" id="signinEmail" placeholder="Enter your email" required>
                        
                        <label for="signinPassword" style="display: block; margin-bottom: 10px; font-weight: 600; margin-top: 15px;">Password:</label>
                        <input type="password" id="signinPassword" placeholder="Enter your password" required>
                        
                        <div id="signinError" style="display: none; color: #dc3545; margin-top: 10px; padding: 10px; background: #f8d7da; border-radius: 5px;"></div>
                        
                        <button class="btn btn-primary" onclick="handleSignIn()" style="width: 100%; margin-top: 20px;">
                            Sign In
                        </button>
                        
                        <button class="btn btn-secondary" onclick="showForgotPassword()" style="width: 100%; margin-top: 10px;">
                            Forgot Password?
                        </button>
                        
                        <div style="margin-top: 25px; text-align: center;">
                            <p style="margin-bottom: 15px; color: #666; font-size: 14px;">Or sign in with:</p>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <button onclick="signInWithGoogle()" class="btn btn-social btn-google" style="width: 100%; background: #4285f4; color: white; border: none; padding: 12px; border-radius: 4px; font-weight: 600; display: flex; align-items: center; justify-content: center;">
                                    <svg width="18" height="18" style="margin-right: 8px;" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                    </svg>
                                    Sign in with Google
                                </button>
                                <button onclick="signInWithMicrosoft()" class="btn btn-social btn-microsoft" style="width: 100%; background: #00a1f1; color: white; border: none; padding: 12px; border-radius: 4px; font-weight: 600; display: flex; align-items: center; justify-content: center;">
                                    <svg width="18" height="18" style="margin-right: 8px;" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M11.4 11.4H2.6V2.6h8.8v8.8zm-1-1h1v-8h-8v8h7zm1 10.6H2.6v-8.8h8.8v8.8zm-1-1h1v-8h-8v8h7zm10.6-9.6h-8.8V2.6h8.8v8.8zm-1-1h1v-8h-8v8h7zm1 10.6h-8.8v-8.8h8.8v8.8zm-1-1h1v-8h-8v8h7z"/>
                                    </svg>
                                    Sign in with Microsoft
                                </button>
                                <button onclick="signInWithApple()" class="btn btn-social btn-apple" style="width: 100%; background: #000; color: white; border: none; padding: 12px; border-radius: 4px; font-weight: 600; display: flex; align-items: center; justify-content: center;">
                                    <svg width="18" height="18" style="margin-right: 8px;" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M17.05 20.28c-.98.95-2.05.88-3.08.43-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.43C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/>
                                    </svg>
                                    Sign in with Apple
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sign Up Form -->
                <div id="signupForm" class="auth-form" style="display: none;">
                    <h2 style="color: #821874; text-align: center;">Create Account</h2>
                    <p style="text-align: center;">Join to start assessing your LEAN maturity</p>
                    
                    <div class="data-warning">
                        <h4>üìù Quick Registration</h4>
                        <p>Create your account in seconds. All users start with regular access.</p>
                    </div>
                    
                    <div style="margin: 30px 0;">
                        <label for="signupName" style="display: block; margin-bottom: 10px; font-weight: 600;">Full Name:</label>
                        <input type="text" id="signupName" placeholder="Enter your full name" required>
                        
                        <label for="signupEmail" style="display: block; margin-bottom: 10px; font-weight: 600; margin-top: 15px;">Email Address:</label>
                        <input type="email" id="signupEmail" placeholder="Enter your email" required>
                        
                        <label for="signupPassword" style="display: block; margin-bottom: 10px; font-weight: 600; margin-top: 15px;">Password:</label>
                        <input type="password" id="signupPassword" placeholder="Choose a strong password (min. 8 characters)" required>
                        
                        <label for="signupPasswordConfirm" style="display: block; margin-bottom: 10px; font-weight: 600; margin-top: 15px;">Confirm Password:</label>
                        <input type="password" id="signupPasswordConfirm" placeholder="Re-enter your password" required>
                        
                        <div id="signupError" style="display: none; color: #dc3545; margin-top: 10px; padding: 10px; background: #f8d7da; border-radius: 5px;"></div>
                        <div id="signupSuccess" style="display: none; color: #28a745; margin-top: 10px; padding: 10px; background: #d4edda; border-radius: 5px;"></div>
                        
                        <button class="btn btn-primary" onclick="handleSignUp()" style="width: 100%; margin-top: 20px;">
                            Create Account
                        </button>
                        
                        <div style="margin-top: 25px; text-align: center;">
                            <p style="margin-bottom: 15px; color: #666; font-size: 14px;">Or sign up with:</p>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <button onclick="signInWithGoogle()" class="btn btn-social btn-google" style="width: 100%; background: #4285f4; color: white; border: none; padding: 12px; border-radius: 4px; font-weight: 600; display: flex; align-items: center; justify-content: center;">
                                    <svg width="18" height="18" style="margin-right: 8px;" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                        <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                        <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                        <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                                    </svg>
                                    Sign up with Google
                                </button>
                                <button onclick="signInWithMicrosoft()" class="btn btn-social btn-microsoft" style="width: 100%; background: #00a1f1; color: white; border: none; padding: 12px; border-radius: 4px; font-weight: 600; display: flex; align-items: center; justify-content: center;">
                                    <svg width="18" height="18" style="margin-right: 8px;" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M11.4 11.4H2.6V2.6h8.8v8.8zm-1-1h1v-8h-8v8h7zm1 10.6H2.6v-8.8h8.8v8.8zm-1-1h1v-8h-8v8h7zm10.6-9.6h-8.8V2.6h8.8v8.8zm-1-1h1v-8h-8v8h7zm1 10.6h-8.8v-8.8h8.8v8.8zm-1-1h1v-8h-8v8h7z"/>
                                    </svg>
                                    Sign up with Microsoft
                                </button>
                                <button onclick="signInWithApple()" class="btn btn-social btn-apple" style="width: 100%; background: #000; color: white; border: none; padding: 12px; border-radius: 4px; font-weight: 600; display: flex; align-items: center; justify-content: center;">
                                    <svg width="18" height="18" style="margin-right: 8px;" viewBox="0 0 24 24" fill="currentColor">
                                        <path d="M17.05 20.28c-.98.95-2.05.88-3.08.43-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.43C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/>
                                    </svg>
                                    Sign up with Apple
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Forgot Password Form -->
                <div id="forgotPasswordForm" class="auth-form" style="display: none;">
                    <h2 style="color: #821874; text-align: center;">Reset Password</h2>
                    <p style="text-align: center;">Enter your email to receive a password reset link</p>
                    
                    <div style="margin: 30px 0;">
                        <label for="resetEmail" style="display: block; margin-bottom: 10px; font-weight: 600;">Email Address:</label>
                        <input type="email" id="resetEmail" placeholder="Enter your email" required>
                        
                        <div id="resetError" style="display: none; color: #dc3545; margin-top: 10px; padding: 10px; background: #f8d7da; border-radius: 5px;"></div>
                        <div id="resetSuccess" style="display: none; color: #28a745; margin-top: 10px; padding: 10px; background: #d4edda; border-radius: 5px;"></div>
                        
                        <button class="btn btn-primary" onclick="handlePasswordReset()" style="width: 100%; margin-top: 20px;">
                            Send Reset Link
                        </button>
                        
                        <button class="btn btn-secondary" onclick="showAuthTab('signin')" style="width: 100%; margin-top: 10px;">
                            Back to Sign In
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation" id="mainNavigation" style="display: none;">
            <button class="nav-btn active" onclick="showPanel('assessment')">New Assessment</button>
            <button class="nav-btn" onclick="showPanel('dashboard')">My Dashboard</button>
            <button class="nav-btn" onclick="showPanel('saved')">My Assessments</button>
            <button class="nav-btn" onclick="showPanel('manual')">Help & Manual</button>
            <button class="nav-btn" id="adminNav" onclick="showPanel('admin')" style="display: none;">Admin Panel</button>
            <button class="nav-btn btn-danger" onclick="userLogout()">Logout</button>
        </div>

        <!-- Assessment Panel -->
        <div id="assessmentPanel" class="panel">
            <div class="data-warning">
                <h4>Assessment Guidelines</h4>
                <p><strong>Please allow 30-45 minutes</strong> to complete this assessment. Answer honestly based on your organization's current state. You can save your progress as a draft at any time.</p>
            </div>

            <form id="assessmentForm">
                <div class="form-section">
                    <h3>Company Information</h3>
                    <div class="question-group">
                        <label for="companyName">Company Name:</label>
                        <input type="text" id="companyName" name="companyName" required>
                    </div>
                    <div class="question-group">
                        <label for="assessorName">Assessor Name:</label>
                        <input type="text" id="assessorName" name="assessorName" required>
                    </div>
                    <div class="question-group">
                        <label for="assessmentDate">Assessment Date:</label>
                        <input type="date" id="assessmentDate" name="assessmentDate" required>
                    </div>
                </div>

                <!-- Assessment questions will be dynamically generated here -->
                <div id="questionsContainer"></div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="saveDraft()">Save Draft</button>
                    <button type="submit" class="btn btn-primary">Submit Assessment</button>
                </div>
            </form>
        </div>

        <div id="dashboardPanel" class="panel">
            <div class="status-overview">
                <h2>LEAN Maturity Assessment Results</h2>
                <div id="assessmentDetails" style="background: linear-gradient(135deg, #f8f4f8 0%, #f0f7fa 100%); padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #821874;"></div>
                <div class="progress-ring">
                    <svg>
                        <circle class="background" cx="100" cy="100" r="85"></circle>
                        <circle class="progress" cx="100" cy="100" r="85" id="progressCircle"></circle>
                    </svg>
                    <div class="progress-text" id="progressText">0%</div>
                </div>
                <div class="status-large" id="statusLarge">Not Assessed</div>
                <div id="statusDescription">Complete an assessment to see your organization's LEAN maturity level</div>
            </div>

            <div class="tabs" id="dashboardTabs" style="display:none;">
                <button class="tab active" onclick="showDashboardTab('overview')">Overview</button>
                <button class="tab" onclick="showDashboardTab('detailed')">Detailed Scores</button>
                <button class="tab" onclick="showDashboardTab('feedback')">Insights</button>
            </div>

            <div id="overviewTab" class="tab-content active">
                <div class="results-grid" id="enhancedResultsGrid"></div>
            </div>

            <div id="detailedTab" class="tab-content">
                <div id="detailedScoresContainer"></div>
            </div>

            <div id="feedbackTab" class="tab-content">
                <div id="feedbackSection" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);"></div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="previewCurrentAssessmentPDF()" id="previewDashboardPDF" style="display:none;">
                    <span style="margin-right: 5px;">üëÅÔ∏è</span> Preview Report
                </button>
                <button type="button" class="btn btn-primary" onclick="exportCurrentAssessmentPDF()" id="exportDashboardPDF" style="display:none;">
                    <span style="margin-right: 5px;">üìÑ</span> Export PDF
                </button>
                <button type="button" class="btn btn-secondary" onclick="showPanel('assessment')">New Assessment</button>
            </div>
        </div>

        <div id="savedPanel" class="panel">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color: #821874; margin: 0;">My Assessments</h2>
                <div>
                    <button class="btn btn-sm btn-primary" onclick="exportAssessmentData()" title="Export all assessments to CSV">
                        üìä Export Data (CSV)
                    </button>
                    <button class="btn btn-sm btn-secondary" onclick="exportUserData()" title="Export all your data (GDPR)">
                        üíæ Export My Data
                    </button>
                </div>
            </div>
            <div class="data-warning">
                <h4>Cloud Storage Information</h4>
                <p>Your assessments are stored securely in the cloud and accessible from any device.</p>
            </div>
            <div class="saved-assessments" id="savedAssessments"></div>
        </div>

        <div id="assessmentResultsPanel" class="panel">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <button class="btn btn-secondary" onclick="showPanel('saved')">
                    ‚Üê Back to My Assessments
                </button>
                <div>
                    <button class="btn btn-secondary" onclick="previewIndividualAssessmentPDF()" id="previewIndividualPDF">
                        üëÅÔ∏è Preview Report
                    </button>
                    <button class="btn btn-primary" onclick="exportIndividualAssessmentPDF()" id="exportIndividualPDF">
                        üìÑ Export PDF
                    </button>
                </div>
            </div>

            <div class="tabs" id="individualTabs">
                <button class="tab active" onclick="showIndividualTab('overview')">Overview</button>
                <button class="tab" onclick="showIndividualTab('detailed')">Detailed Scores</button>
                <button class="tab" onclick="showIndividualTab('feedback')">Insights</button>
            </div>

            <div id="individualOverviewTab" class="tab-content active">
                <div id="individualResultsContainer"></div>
            </div>

            <div id="individualDetailedTab" class="tab-content">
                <div id="individualDetailedScoresContainer"></div>
            </div>

            <div id="individualFeedbackTab" class="tab-content">
                <div id="individualFeedbackSection" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);"></div>
            </div>
        </div>

        <div id="manualPanel" class="panel">
            <div class="manual-content">
                <h1 style="color: #821874;">MEGA LEAN Assessment Tool - User Manual</h1>
                <h2>Getting Started</h2>
                <p>The MEGA LEAN Assessment Tool evaluates your organization's LEAN maturity across 7 key dimensions.</p>
                <h2>Understanding Your Results</h2>
                <h3>LEAN Maturity Levels</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Score Range</th>
                            <th>Status</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>0-48%</td>
                            <td><span style="background: #dc3545; color: white; padding: 4px 8px; border-radius: 4px;">Novice</span></td>
                            <td>Initial LEAN implementation with limited practices</td>
                        </tr>
                        <tr>
                            <td>49-66%</td>
                            <td><span style="background: #fd7e14; color: white; padding: 4px 8px; border-radius: 4px;">Emerging</span></td>
                            <td>Developing LEAN practices with some consistency</td>
                        </tr>
                        <tr>
                            <td>67-82%</td>
                            <td><span style="background: #ffc107; color: white; padding: 4px 8px; border-radius: 4px;">Developing</span></td>
                            <td>Established LEAN practices with good maturity</td>
                        </tr>
                        <tr>
                            <td>83-100%</td>
                            <td><span style="background: #159eda; color: white; padding: 4px 8px; border-radius: 4px;">Advanced</span></td>
                            <td>Highly mature and embedded LEAN culture</td>
                        </tr>
                    </tbody>
                </table>
                <h2>Rating Scale</h2>
                <ul>
                    <li><strong>1 - Strongly Disagree:</strong> This practice doesn't exist</li>
                    <li><strong>2 - Disagree:</strong> This practice exists but is inconsistent/poor</li>
                    <li><strong>3 - Neutral:</strong> This practice exists but has room for improvement</li>
                    <li><strong>4 - Agree:</strong> This practice is well-established and effective</li>
                    <li><strong>5 - Strongly Agree:</strong> This practice is excellent and consistently applied</li>
                </ul>

                <h2>Tips for Best Results</h2>
                <ul>
                    <li><strong>Be honest</strong> - Answer based on current reality</li>
                    <li><strong>Allow adequate time</strong> - Plan 30-45 minutes</li>
                    <li><strong>Involve others</strong> - Consider multiple perspectives</li>
                    <li><strong>Stay consistent</strong> - Apply same perspective throughout</li>
                </ul>

                <h2>For More Information</h2>
                <p>Contact Barry at <a href="mailto:barry.taylor@midulstermega.com">barry.taylor@midulstermega.com</a> for training programs and services.</p>
                <p>Visit our websites for more information:</p>
                <ul>
                    <li><a href="https://midulstermega.com/" target="_blank">MEGA Website</a></li>
                    <li><a href="https://kaizenacademy.education/" target="_blank">Kaizen Academy</a></li>
                </ul>
            </div>
        </div>

        <div id="adminPanel" class="panel">
            <h2 style="color: #821874;">Administrator Dashboard</h2>
            <div id="adminStats" class="results-grid" style="margin-bottom: 30px;"></div>

            <div class="tabs">
                <button class="tab active" onclick="showAdminTab('assessments')">Assessments</button>
                <button class="tab" onclick="showAdminTab('users')">User Management</button>
            </div>

            <div id="adminAssessmentsTab" class="tab-content active">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                    <div class="data-warning" style="flex: 1; margin-right: 15px; margin-bottom: 0;">
                        <h4>Assessment Management</h4>
                        <p>View and manage all assessments in the system.</p>
                    </div>
                    <button class="btn btn-primary" onclick="exportAllAssessmentsData()" title="Export all assessments to CSV" style="white-space: nowrap;">
                        üìä Export All Data (CSV)
                    </button>
                </div>

                <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Filter by User:</label>
                            <input type="text" id="filterUser" placeholder="Email or name" onkeyup="filterAssessments()" style="margin-bottom: 0;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Filter by Company:</label>
                            <input type="text" id="filterCompany" placeholder="Company name" onkeyup="filterAssessments()" style="margin-bottom: 0;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Status:</label>
                            <select id="filterStatus" onchange="filterAssessments()" style="margin-bottom: 0;">
                                <option value="all">All</option>
                                <option value="completed">Completed</option>
                                <option value="draft">Draft</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div id="adminAssessmentsTable"></div>
            </div>

            <div id="adminUsersTab" class="tab-content">
                <div class="data-warning">
                    <h4>User Management</h4>
                    <p>Manage user accounts and permissions.</p>
                </div>
                <div id="adminUsersTable"></div>
            </div>
        </div>

        <div id="pdfPreviewModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; overflow: auto;">
            <div style="position: relative; max-width: 900px; margin: 20px auto; background: white; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                <div style="position: sticky; top: 0; background: linear-gradient(135deg, #821874 0%, #159eda 100%); color: white; padding: 20px; border-radius: 8px 8px 0 0; z-index: 10; display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="margin: 0;">üìÑ PDF Report Preview</h2>
                    <button onclick="closePDFPreview()" style="background: white; color: #821874; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: 600;">‚úï Close</button>
                </div>
                <div id="pdfPreviewContent" style="padding: 30px; max-height: calc(100vh - 160px); overflow-y: auto;"></div>
                <div style="position: sticky; bottom: 0; background: #f8f8f8; padding: 20px; border-radius: 0 0 8px 8px; border-top: 1px solid #ddd; display: flex; justify-content: flex-end; gap: 10px;">
                    <button onclick="closePDFPreview()" class="btn btn-secondary">Cancel</button>
                    <button onclick="confirmExportPDF()" class="btn btn-primary">üìÑ Export PDF</button>
                </div>
            </div>
        </div>

        <div id="editUserModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; overflow: auto;">
            <div style="position: relative; max-width: 600px; margin: 50px auto; background: white; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                <div style="background: linear-gradient(135deg, #821874 0%, #159eda 100%); color: white; padding: 20px; border-radius: 8px 8px 0 0; display: flex; justify-content: space-between; align-items: center;">
                    <h2 style="margin: 0;">‚úèÔ∏è Edit User Details</h2>
                    <button onclick="closeEditUserModal()" style="background: white; color: #821874; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-weight: 600;">‚úï Close</button>
                </div>
                <div style="padding: 30px;">
                    <input type="hidden" id="editUserId">

                    <div style="margin-bottom: 20px;">
                        <label for="editUserName" style="display: block; margin-bottom: 8px; font-weight: 600; color: #2d2d2d;">Full Name:</label>
                        <input type="text" id="editUserName" placeholder="Enter full name" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label for="editUserEmail" style="display: block; margin-bottom: 8px; font-weight: 600; color: #2d2d2d;">Email Address:</label>
                        <input type="email" id="editUserEmail" placeholder="Email is managed by Firebase Auth" style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;" disabled>
                        <small style="color: #666; font-size: 12px;">Email cannot be changed from the client app</small>
                    </div>

                    <div id="editUserError" style="display: none; color: #dc3545; margin-bottom: 15px; padding: 10px; background: #f8d7da; border-radius: 5px;"></div>
                    <div id="editUserSuccess" style="display: none; color: #28a745; margin-bottom: 15px; padding: 10px; background: #d4edda; border-radius: 5px;"></div>
                </div>
                <div style="background: #f8f8f8; padding: 20px; border-radius: 0 0 8px 8px; border-top: 1px solid #ddd; display: flex; justify-content: flex-end; gap: 10px;">
                    <button onclick="closeEditUserModal()" class="btn btn-secondary">Cancel</button>
                    <button onclick="saveUserEdit()" class="btn btn-primary">üíæ Save Changes</button>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>¬© <span id="currentYear"></span> MEGA LEAN Assessment Tool</p>
            <p>Designed by <strong>Kaizen Academy‚Ñ¢</strong></p>
            <p><a href="https://kaizenacademy.education/" target="_blank">Learn More</a> | <a href="mailto:learn@continuousimprovement.education">Contact Us</a></p>
        </div>

    </div>

    <!-- JavaScript Modules -->
    <script src="config_firebase.js"></script>
    <script src="auth_firebase.js"></script>
    <script src="database_firebase.js"></script>
    <script src="assessment.js"></script>
    <script src="admin.js"></script>
    <script src="export.js"></script>

    <!-- Initialize App -->
    <script>
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeAuth();
            if (typeof initializeAssessment === 'function') {
                initializeAssessment();
            }
        });

        // Handle form submission
        document.getElementById('assessmentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            if (typeof submitAssessment === 'function') {
                await submitAssessment();
            }
        });

        const currentYearEl = document.getElementById('currentYear');
        if (currentYearEl) {
            currentYearEl.textContent = new Date().getFullYear();
        }

        // Basic panel switching function
        function showPanel(panelName) {
            // Hide all panels
            document.querySelectorAll('.panel').forEach(panel => {
                panel.style.display = 'none';
                panel.classList.remove('active');
            });
            
            // Show selected panel
            const selectedPanel = document.getElementById(panelName + 'Panel');
            if (selectedPanel) {
                selectedPanel.style.display = 'block';
                selectedPanel.classList.add('active');
            }
            
            // Update navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const activeBtn = document.querySelector(`[onclick="showPanel('${panelName}')"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
        }
    </script>
</body>
</html>
